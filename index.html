<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Darul Huda NIICS - Advanced Stationery Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --dark-color: #2b2d42;
            --light-color: #f8f9fa;
            --sidebar-width: 280px;
            --header-height: 80px;
            --gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark-color);
        }

        /* Enhanced Login Page */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: url('https://images.unsplash.com/photo-1557804506-669a67965ba0?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80') no-repeat center center;
            background-size: cover;
            position: relative;
            padding: 20px;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(67, 97, 238, 0.8);
            z-index: 0;
        }

        .login-wrapper {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 1200px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .login-hero {
            flex: 1;
            padding: 40px;
            color: white;
            max-width: 500px;
        }

        .login-hero h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .login-hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        .features-list {
            list-style: none;
            margin-top: 30px;
        }

        .features-list li {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .features-list i {
            background: rgba(255, 255, 255, 0.2);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 40px;
            width: 100%;
            max-width: 450px;
            animation: slideInRight 0.8s ease-out;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h2 {
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .login-header p {
            color: #666;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-label {
            font-weight: 500;
            margin-bottom: 8px;
            display: block;
            color: var(--dark-color);
        }

        .form-control {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 12px 15px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .input-icon {
            position: absolute;
            right: 15px;
            top: 40px;
            color: #999;
        }

        .btn-login {
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
        }

        .login-footer {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }

        .login-footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .role-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .role-option {
            flex: 1;
            text-align: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .role-option.active {
            border-color: var(--primary-color);
            background: rgba(67, 97, 238, 0.1);
        }

        .role-option i {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        /* Enhanced Main Application */
        .app-container {
            display: none;
            min-height: 100vh;
            background: #f5f7fa;
        }

        /* Enhanced Header */
        .app-header {
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            height: var(--header-height);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            padding: 0 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .logo i {
            margin-right: 10px;
            font-size: 1.8rem;
        }

        .header-actions {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Enhanced Sidebar */
        .app-sidebar {
            position: fixed;
            top: var(--header-height);
            left: 0;
            bottom: 0;
            width: var(--sidebar-width);
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 999;
            overflow-y: auto;
            transition: all 0.3s;
        }

        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }

        .menu-item {
            margin-bottom: 5px;
        }

        .menu-link {
            display: flex;
            align-items: center;
            padding: 12px 25px;
            color: var(--dark-color);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .menu-link:hover, .menu-link.active {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }

        .menu-link i {
            margin-right: 15px;
            font-size: 1.2rem;
        }

        /* Enhanced Main Content */
        .app-content {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 30px;
            min-height: calc(100vh - var(--header-height));
            transition: all 0.3s;
        }

        .page-header {
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .page-subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        /* Enhanced Cards */
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
            border: none;
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            background: white;
            border-bottom: 1px solid #eee;
            padding: 20px 25px;
            border-radius: 15px 15px 0 0 !important;
        }

        .card-title {
            font-weight: 600;
            margin-bottom: 0;
            color: var(--dark-color);
        }

        .card-body {
            padding: 25px;
        }

        /* Enhanced Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-right: 20px;
            color: white;
        }

        .stat-content h3 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--dark-color);
        }

        .stat-content p {
            color: #666;
            margin-bottom: 0;
        }

        /* Enhanced Tables */
        .table-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .table {
            margin-bottom: 0;
        }

        .table th {
            background: #f8f9fa;
            border: none;
            padding: 15px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .table td {
            padding: 15px;
            vertical-align: middle;
            border-color: #f0f0f0;
        }

        /* Enhanced Buttons */
        .btn {
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--gradient);
            border: none;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }

        /* Enhanced Modals */
        .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            background: var(--gradient);
            color: white;
            border-radius: 15px 15px 0 0;
            border: none;
            padding: 20px 25px;
        }

        .modal-title {
            font-weight: 600;
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .app-sidebar {
                transform: translateX(-100%);
            }
            
            .app-sidebar.active {
                transform: translateX(0);
            }
            
            .app-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block !important;
            }

            .login-wrapper {
                flex-direction: column;
            }

            .login-hero {
                text-align: center;
                max-width: 100%;
                margin-bottom: 30px;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .page-title {
                font-size: 1.5rem;
            }
        }

        /* Utility Classes */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark-color);
            cursor: pointer;
        }

        .text-gradient {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-success {
            background: rgba(76, 201, 240, 0.2);
            color: #4cc9f0;
        }

        .badge-warning {
            background: rgba(247, 37, 133, 0.2);
            color: #f72585;
        }

        .badge-primary {
            background: rgba(67, 97, 238, 0.2);
            color: #4361ee;
        }

        .badge-danger {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        .badge-secondary {
            background: rgba(108, 117, 125, 0.2);
            color: #6c757d;
        }

        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Chart containers */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* Search and filter */
        .search-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .filter-select {
            min-width: 200px;
        }

        /* Advanced Filter Panel */
        .advanced-filter {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            display: none;
        }

        .filter-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .filter-title {
            font-weight: 600;
            margin-bottom: 0;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        /* Settings panel */
        .settings-section {
            margin-bottom: 30px;
        }

        .settings-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .settings-title {
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark-color);
            font-size: 1.2rem;
        }

        /* Toggle switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Export buttons */
        .export-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        /* Activity logs */
        .activity-log {
            max-height: 400px;
            overflow-y: auto;
        }

        .log-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }

        .log-item:last-child {
            border-bottom: none;
        }

        .log-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 1.2rem;
        }

        .log-content {
            flex: 1;
        }

        .log-time {
            color: #999;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-wrapper">
            <div class="login-hero">
                <h1>Advanced Stationery Management System</h1>
                <p>Streamline your stationery requests, approvals, and inventory management with our comprehensive solution.</p>
                
                <ul class="features-list">
                    <li><i class="bi bi-check-circle"></i> Role-based access control</li>
                    <li><i class="bi bi-check-circle"></i> Real-time inventory tracking</li>
                    <li><i class="bi bi-check-circle"></i> Automated approval workflows</li>
                    <li><i class="bi bi-check-circle"></i> Comprehensive reporting</li>
                    <li><i class="bi bi-check-circle"></i> Mobile-responsive design</li>
                </ul>
            </div>
            
            <div class="login-card">
                <div class="login-header">
                    <h2>Darul Huda NIICS</h2>
                    <p>Sign in to your account</p>
                </div>
                
                <form id="loginForm">
                    <div class="role-selector">
                        <div class="role-option active" data-role="student">
                            <i class="bi bi-person"></i>
                            <div>Student</div>
                        </div>
                        <div class="role-option" data-role="teacher">
                            <i class="bi bi-person-badge"></i>
                            <div>Teacher</div>
                        </div>
                        <div class="role-option" data-role="admin">
                            <i class="bi bi-shield-check"></i>
                            <div>Admin</div>
                        </div>
                    </div>
                    
                    <input type="hidden" id="roleSelect" value="student">
                    
                    <div class="form-group">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" placeholder="Enter your username" required>
                        <i class="bi bi-person input-icon"></i>
                    </div>
                    
                    <div class="form-group">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" placeholder="Enter your password" required>
                        <i class="bi bi-lock input-icon"></i>
                    </div>
                    
                    <button type="submit" class="btn-login">Sign In</button>
                    
                    <div class="login-footer">
                        <a href="#" id="forgotPassword">Forgot your password?</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="appContainer" class="app-container">
        <!-- Header -->
        <header class="app-header">
            <button class="menu-toggle" id="menuToggle">
                <i class="bi bi-list"></i>
            </button>
            
            <div class="logo">
                <i class="bi bi-pencil-square"></i>
                <span>Darul Huda NIICS</span>
            </div>
            
            <div class="header-actions">
                <div class="user-profile" id="userProfile">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div>
                        <div id="userName">User Name</div>
                        <small id="userRole">Student</small>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <nav class="app-sidebar" id="sidebar">
            <ul class="sidebar-menu" id="sidebarMenu">
                <!-- Menu items will be dynamically populated -->
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="app-content" id="mainContent">
            <!-- Dashboard content will be dynamically populated -->
        </main>
    </div>

    <!-- Modals -->
    <!-- Request Stationery Modal -->
    <div class="modal fade" id="requestModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Request Stationery</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="requestForm">
                        <div class="form-group">
                            <label for="itemSelect" class="form-label">Select Item</label>
                            <select class="form-control" id="itemSelect" required>
                                <option value="">Select an item</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="quantity" class="form-label">Quantity</label>
                            <input type="number" class="form-control" id="quantity" min="1" required>
                        </div>
                        <div class="form-group">
                            <label for="notes" class="form-label">Notes (Optional)</label>
                            <textarea class="form-control" id="notes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitRequest">Submit Request</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Student Modal -->
    <div class="modal fade" id="studentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="studentModalTitle">Add Student</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="studentForm">
                        <input type="hidden" id="studentId">
                        <div class="form-group">
                            <label for="admissionNo" class="form-label">Admission No</label>
                            <input type="text" class="form-control" id="admissionNo" required>
                        </div>
                        <div class="form-group">
                            <label for="studentName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="studentName" required>
                        </div>
                        <div class="form-group">
                            <label for="studentClass" class="form-label">Class</label>
                            <select class="form-control" id="studentClass" required>
                                <option value="">Select a class</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="studentUsername" class="form-label">Username</label>
                            <input type="text" class="form-control" id="studentUsername" required>
                        </div>
                        <div class="form-group">
                            <label for="studentPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="studentPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="studentEmail" class="form-label">Email (Optional)</label>
                            <input type="email" class="form-control" id="studentEmail">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveStudent">Save Student</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Class Modal -->
    <div class="modal fade" id="classModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="classModalTitle">Add Class</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="classForm">
                        <input type="hidden" id="classId">
                        <div class="form-group">
                            <label for="className" class="form-label">Class Name</label>
                            <input type="text" class="form-control" id="className" required>
                        </div>
                        <div class="form-group">
                            <label for="classTeacher" class="form-label">Class Teacher</label>
                            <input type="text" class="form-control" id="classTeacher" required>
                        </div>
                        <div class="form-group">
                            <label for="teacherUsername" class="form-label">Teacher Username</label>
                            <input type="text" class="form-control" id="teacherUsername" required>
                        </div>
                        <div class="form-group">
                            <label for="teacherPassword" class="form-label">Teacher Password</label>
                            <input type="password" class="form-control" id="teacherPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="teacherEmail" class="form-label">Teacher Email</label>
                            <input type="email" class="form-control" id="teacherEmail" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveClass">Save Class</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Stationery Item Modal -->
    <div class="modal fade" id="itemModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="itemModalTitle">Add Stationery Item</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="itemForm">
                        <input type="hidden" id="itemId">
                        <div class="form-group">
                            <label for="itemName" class="form-label">Item Name</label>
                            <input type="text" class="form-control" id="itemName" required>
                        </div>
                        <div class="form-group">
                            <label for="itemCategory" class="form-label">Category</label>
                            <select class="form-control" id="itemCategory" required>
                                <option value="">Select a category</option>
                                <option value="Writing">Writing</option>
                                <option value="Notebook">Notebook</option>
                                <option value="Drawing">Drawing</option>
                                <option value="Files">Files</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="itemPrice" class="form-label">Price (₹)</label>
                            <input type="number" class="form-control" id="itemPrice" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="itemStock" class="form-label">Stock</label>
                            <input type="number" class="form-control" id="itemStock" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="itemDescription" class="form-label">Description (Optional)</label>
                            <textarea class="form-control" id="itemDescription" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveItem">Save Item</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">My Profile</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="profileForm">
                        <div class="form-group">
                            <label class="form-label">Name</label>
                            <input type="text" class="form-control" id="profileName" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" id="profileUsername" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Role</label>
                            <input type="text" class="form-control" id="profileRole" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Class</label>
                            <input type="text" class="form-control" id="profileClass" readonly>
                        </div>
                        <hr>
                        <h6>Change Password</h6>
                        <div class="form-group">
                            <label for="currentPassword" class="form-label">Current Password</label>
                            <input type="password" class="form-control" id="currentPassword">
                        </div>
                        <div class="form-group">
                            <label for="newPassword" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="newPassword">
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword" class="form-label">Confirm New Password</label>
                            <input type="password" class="form-control" id="confirmPassword">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="updatePassword">Update Password</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">System Settings</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="settings-section">
                        <h6 class="settings-title">General Settings</h6>
                        <div class="settings-card">
                            <div class="form-group d-flex justify-content-between align-items-center">
                                <label for="autoApprove" class="form-label mb-0">Auto-approve requests under ₹100</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="autoApprove">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group d-flex justify-content-between align-items-center mt-3">
                                <label for="lowStockAlert" class="form-label mb-0">Low stock alerts</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="lowStockAlert" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="form-group d-flex justify-content-between align-items-center mt-3">
                                <label for="emailNotifications" class="form-label mb-0">Email notifications</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="emailNotifications" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h6 class="settings-title">Request Limits</h6>
                        <div class="settings-card">
                            <div class="form-group">
                                <label for="maxRequestsPerDay" class="form-label">Max requests per day per student</label>
                                <input type="number" class="form-control" id="maxRequestsPerDay" value="3">
                            </div>
                            <div class="form-group">
                                <label for="maxAmountPerMonth" class="form-label">Max amount per month per student (₹)</label>
                                <input type="number" class="form-control" id="maxAmountPerMonth" value="500">
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h6 class="settings-title">System Information</h6>
                        <div class="settings-card">
                            <div class="form-group">
                                <label class="form-label">System Version</label>
                                <input type="text" class="form-control" value="v2.1.0" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Last Backup</label>
                                <input type="text" class="form-control" value="2023-11-15 02:30 AM" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Database Size</label>
                                <input type="text" class="form-control" value="24.5 MB" readonly>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveSettings">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="toast" class="toast" role="alert">
            <div class="toast-header">
                <i class="bi bi-info-circle me-2 text-primary"></i>
                <strong class="me-auto">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                This is a notification message.
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Application State
        const appState = {
            currentUser: null,
            currentRole: 'student',
            currentPage: 'dashboard',
            data: {
                classes: [],
                students: [],
                teachers: [],
                stationery: [],
                requests: [],
                reports: [],
                settings: {
                    autoApprove: false,
                    lowStockAlert: true,
                    emailNotifications: true,
                    maxRequestsPerDay: 3,
                    maxAmountPerMonth: 500
                }
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadSampleData();
        });

        // Initialize the application
        function initializeApp() {
            // Set up role selection
            const roleOptions = document.querySelectorAll('.role-option');
            roleOptions.forEach(option => {
                option.addEventListener('click', function() {
                    roleOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById('roleSelect').value = this.dataset.role;
                });
            });

            // Set up login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });

            // Set up menu toggle for mobile
            document.getElementById('menuToggle').addEventListener('click', function() {
                document.getElementById('sidebar').classList.toggle('active');
            });

            // Set up user profile click
            document.getElementById('userProfile').addEventListener('click', function() {
                showProfileModal();
            });
        }

        // Set up event listeners
        function setupEventListeners() {
            // Request modal
            document.getElementById('submitRequest').addEventListener('click', submitRequest);
            
            // Student modal
            document.getElementById('saveStudent').addEventListener('click', saveStudent);
            
            // Class modal
            document.getElementById('saveClass').addEventListener('click', saveClass);
            
            // Item modal
            document.getElementById('saveItem').addEventListener('click', saveItem);
            
            // Profile modal
            document.getElementById('updatePassword').addEventListener('click', updatePassword);
            
            // Settings modal
            document.getElementById('saveSettings').addEventListener('click', saveSettings);
            
            // Forgot password
            document.getElementById('forgotPassword').addEventListener('click', function(e) {
                e.preventDefault();
                showToast('Password reset instructions have been sent to your email.', 'info');
            });
        }

        // Handle user login
        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('roleSelect').value;
            
            // Simple validation
            if (!username || !password) {
                showToast('Please enter both username and password.', 'warning');
                return;
            }
            
            // In a real app, this would be an API call
            // For demo purposes, we'll simulate a successful login
            const user = authenticateUser(username, password, role);
            
            if (user) {
                appState.currentUser = user;
                appState.currentRole = role;
                
                // Update UI
                document.getElementById('userName').textContent = user.name;
                document.getElementById('userRole').textContent = role.charAt(0).toUpperCase() + role.slice(1);
                document.getElementById('userAvatar').textContent = user.name.charAt(0).toUpperCase();
                
                // Show main app, hide login
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                
                // Load the appropriate dashboard
                loadDashboard();
                
                showToast(`Welcome back, ${user.name}!`, 'success');
            } else {
                showToast('Invalid username or password. Please try again.', 'error');
            }
        }

        // Simulate user authentication
        function authenticateUser(username, password, role) {
            // In a real app, this would check against a database
            // For demo, we'll use hardcoded values
            const users = {
                student: [
                    { id: 1, admissionNo: 'S001', name: 'Ahmed Khan', username: 'ahmed', password: 'password', class: 'U1' },
                    { id: 2, admissionNo: 'S002', name: 'Fatima Ali', username: 'fatima', password: 'password', class: 'U2' }
                ],
                teacher: [
                    { id: 1, name: 'Mr. Rahman', username: 'rahman', password: 'password', class: 'U1' },
                    { id: 2, name: 'Ms. Zara', username: 'zara', password: 'password', class: 'U2' }
                ],
                admin: [
                    { id: 1, name: 'Admin User', username: 'admin', password: 'admin', class: null }
                ]
            };
            
            const userList = users[role];
            if (!userList) return null;
            
            return userList.find(user => 
                user.username === username && user.password === password
            ) || null;
        }

        // Load the appropriate dashboard based on user role
        function loadDashboard() {
            // Clear existing content
            document.getElementById('mainContent').innerHTML = '';
            
            // Load sidebar menu based on role
            loadSidebarMenu();
            
            // Load dashboard content based on role
            switch(appState.currentRole) {
                case 'student':
                    loadStudentDashboard();
                    break;
                case 'teacher':
                    loadTeacherDashboard();
                    break;
                case 'admin':
                    loadAdminDashboard();
                    break;
            }
        }

        // Load sidebar menu based on user role
        function loadSidebarMenu() {
            const sidebarMenu = document.getElementById('sidebarMenu');
            sidebarMenu.innerHTML = '';
            
            let menuItems = [];
            
            switch(appState.currentRole) {
                case 'student':
                    menuItems = [
                        { id: 'dashboard', name: 'Dashboard', icon: 'bi-house' },
                        { id: 'profile', name: 'My Profile', icon: 'bi-person' },
                        { id: 'request', name: 'Request Stationery', icon: 'bi-plus-circle' },
                        { id: 'myRequests', name: 'My Requests', icon: 'bi-list-ul' }
                    ];
                    break;
                case 'teacher':
                    menuItems = [
                        { id: 'dashboard', name: 'Dashboard', icon: 'bi-house' },
                        { id: 'classRequests', name: 'Class Requests', icon: 'bi-clipboard-check' },
                        { id: 'classStudents', name: 'Class Students', icon: 'bi-people' },
                        { id: 'reports', name: 'Reports', icon: 'bi-graph-up' }
                    ];
                    break;
                case 'admin':
                    menuItems = [
                        { id: 'dashboard', name: 'Dashboard', icon: 'bi-house' },
                        { id: 'classes', name: 'Manage Classes', icon: 'bi-journal-text' },
                        { id: 'students', name: 'Manage Students', icon: 'bi-people' },
                        { id: 'requests', name: 'Stationery Requests', icon: 'bi-clipboard-check' },
                        { id: 'inventory', name: 'Inventory', icon: 'bi-box-seam' },
                        { id: 'reports', name: 'Reports', icon: 'bi-graph-up' },
                        { id: 'settings', name: 'Settings', icon: 'bi-gear' }
                    ];
                    break;
            }
            
            // Add menu items to sidebar
            menuItems.forEach(item => {
                const menuItem = document.createElement('li');
                menuItem.className = 'menu-item';
                
                const menuLink = document.createElement('a');
                menuLink.href = '#';
                menuLink.className = 'menu-link';
                if (item.id === appState.currentPage) {
                    menuLink.classList.add('active');
                }
                menuLink.innerHTML = `
                    <i class="${item.icon}"></i>
                    <span>${item.name}</span>
                `;
                
                menuLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active menu item
                    document.querySelectorAll('.menu-link').forEach(link => {
                        link.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Load the selected page
                    appState.currentPage = item.id;
                    loadPage(item.id);
                });
                
                menuItem.appendChild(menuLink);
                sidebarMenu.appendChild(menuItem);
            });
            
            // Add logout button
            const logoutItem = document.createElement('li');
            logoutItem.className = 'menu-item';
            
            const logoutLink = document.createElement('a');
            logoutLink.href = '#';
            logoutLink.className = 'menu-link';
            logoutLink.innerHTML = `
                <i class="bi bi-box-arrow-right"></i>
                <span>Logout</span>
            `;
            
            logoutLink.addEventListener('click', function(e) {
                e.preventDefault();
                logout();
            });
            
            logoutItem.appendChild(logoutLink);
            sidebarMenu.appendChild(logoutItem);
        }

        // Load a specific page
        function loadPage(page) {
            switch(page) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'profile':
                    loadProfilePage();
                    break;
                case 'request':
                    showRequestModal();
                    break;
                case 'myRequests':
                    loadMyRequestsPage();
                    break;
                case 'classes':
                    loadClassesPage();
                    break;
                case 'students':
                    loadStudentsPage();
                    break;
                case 'requests':
                    loadRequestsPage();
                    break;
                case 'inventory':
                    loadInventoryPage();
                    break;
                case 'reports':
                    loadReportsPage();
                    break;
                case 'settings':
                    loadSettingsPage();
                    break;
                case 'classRequests':
                    loadClassRequestsPage();
                    break;
                case 'classStudents':
                    loadClassStudentsPage();
                    break;
            }
        }

        // Load student dashboard
        function loadStudentDashboard() {
            const content = document.getElementById('mainContent');
            
            // Get student's requests
            const studentRequests = appState.data.requests.filter(
                req => req.studentId === appState.currentUser.id
            );
            
            const pendingRequests = studentRequests.filter(req => req.status === 'pending').length;
            const approvedRequests = studentRequests.filter(req => req.status === 'approved').length;
            const completedRequests = studentRequests.filter(req => req.status === 'completed').length;
            
            // Calculate total amount
            const totalAmount = studentRequests
                .filter(req => req.status === 'completed')
                .reduce((sum, req) => sum + (req.price * req.quantity), 0);
            
            content.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Student Dashboard</h1>
                    <p class="page-subtitle">Welcome back, ${appState.currentUser.name}</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card fade-in">
                        <div class="stat-icon" style="background: var(--gradient);">
                            <i class="bi bi-journal-text"></i>
                        </div>
                        <div class="stat-content">
                            <h3>${studentRequests.length}</h3>
                            <p>Total Requests</p>
                        </div>
                    </div>
                    
                    <div class="stat-card fade-in">
                        <div class="stat-icon" style="background: #4cc9f0;">
                            <i class="bi bi-clock-history"></i>
                        </div>
                        <div class="stat-content">
                            <h3>${pendingRequests}</h3>
                            <p>Pending Requests</p>
                        </div>
                    </div>
                    
                    <div class="stat-card fade-in">
                        <div class="stat-icon" style="background: #7209b7;">
                            <i class="bi bi-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <h3>${approvedRequests}</h3>
                            <p>Approved Requests</p>
                        </div>
                    </div>
                    
                    <div class="stat-card fade-in">
                        <div class="stat-icon" style="background: #f72585;">
                            <i class="bi bi-currency-rupee"></i>
                        </div>
                        <div class="stat-content">
                            <h3>₹${totalAmount}</h3>
                            <p>Total Amount</p>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Recent Requests</h5>
                            </div>
                            <div class="card-body">
                                ${studentRequests.length > 0 ? `
                                <div class="table-container">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Item</th>
                                                <th>Quantity</th>
                                                <th>Date</th>
                                                <th>Status</th>
                                                <th>Amount</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${studentRequests.slice(0, 5).map(request => `
                                                <tr>
                                                    <td>${request.itemName}</td>
                                                    <td>${request.quantity}</td>
                                                    <td>${request.date}</td>
                                                    <td><span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></td>
                                                    <td>${request.price ? '₹' + (request.price * request.quantity) : '-'}</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                                ` : '<p class="text-center py-4">No requests found. <a href="#" id="makeFirstRequest">Make your first request</a></p>'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-primary w-100 mb-3" id="requestStationeryBtn">
                                    <i class="bi bi-plus-circle me-2"></i> Request Stationery
                                </button>
                                <button class="btn btn-outline-primary w-100 mb-3" id="viewRequestsBtn">
                                    <i class="bi bi-list-ul me-2"></i> View My Requests
                                </button>
                                <button class="btn btn-outline-secondary w-100" id="viewProfileBtn">
                                    <i class="bi bi-person me-2"></i> My Profile
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Notifications</h5>
                            </div>
                            <div class="card-body">
                                ${studentRequests.filter(req => req.status === 'approved' && !req.notified).length > 0 ? `
                                <div class="alert alert-success">
                                    <i class="bi bi-check-circle me-2"></i>
                                    You have ${studentRequests.filter(req => req.status === 'approved' && !req.notified).length} approved requests!
                                </div>
                                ` : ''}
                                
                                ${studentRequests.filter(req => req.status === 'completed' && !req.notified).length > 0 ? `
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle me-2"></i>
                                    You have ${studentRequests.filter(req => req.status === 'completed' && !req.notified).length} completed requests!
                                </div>
                                ` : ''}
                                
                                ${studentRequests.length === 0 ? `
                                <p class="text-muted text-center">No new notifications</p>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for buttons
            if (document.getElementById('requestStationeryBtn')) {
                document.getElementById('requestStationeryBtn').addEventListener('click', showRequestModal);
            }
            
            if (document.getElementById('viewRequestsBtn')) {
                document.getElementById('viewRequestsBtn').addEventListener('click', function() {
                    appState.currentPage = 'myRequests';
                    loadMyRequestsPage();
                });
            }
            
            if (document.getElementById('viewProfileBtn')) {
                document.getElementById('viewProfileBtn').addEventListener('click', showProfileModal);
            }
            
            if (document.getElementById('makeFirstRequest')) {
                document.getElementById('makeFirstRequest').addEventListener('click', function(e) {
                    e.preventDefault();
                    showRequestModal();
                });
            }
        }

        // Load teacher dashboard
        function loadTeacherDashboard() {
            const content = document.getElementById('mainContent');
            
            // Get teacher's class
            const teacherClass = appState.currentUser.class;
            
            // Get students in teacher's class
            const classStudents = appState.data.students.filter(
                student => student.class === teacherClass
            );
            
            // Get requests from teacher's class
            const classRequests = appState.data.requests.filter(
                req => {
                    const student = appState.data.students.find(s => s.id === req.studentId);
                    return student && student.class === teacherClass;
                }
            );
            
            const pendingRequests = classRequests.filter(req => req.status === 'pending').length;
            const approvedRequests = classRequests.filter(req => req.status === 'approved').length;
            const completedRequests = classRequests.filter(req => req.status === 'completed').length;
            
            // Calculate total amount for class
            const totalAmount = classRequests
                .filter(req => req.status === 'completed')
                .reduce((sum, req) => sum + (req.price * req.quantity), 0);
            
            content.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Teacher Dashboard</h1>
                    <p class="page-subtitle">Class: ${teacherClass} | Teacher: ${appState.currentUser.name}</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card fade-in">
                        <div class="stat-icon" style="background: var(--gradient);">
                            <i class="bi bi-people"></i>
                        </div>
                        <div class="stat-content">
                            <h3>${classStudents.length}</h3>
                            <p>Students</p>
                        </div>
                    </div>
                    
                    <div class="stat-card fade-in">
                        <div class="stat-icon" style="background: #4cc9f0;">
                            <i class="bi bi-journal-text"></i>
                        </div>
                        <div class="stat-content">
                            <h3>${classRequests.length}</h3>
                            <p>Total Requests</p>
                        </div>
                    </div>
                    
                    <div class="stat-card fade-in">
                        <div class="stat-icon" style="background: #7209b7;">
                            <i class="bi bi-clock-history"></i>
                        </div>
                        <div class="stat-content">
                            <h3>${pendingRequests}</h3>
                            <p>Pending Requests</p>
                        </div>
                    </div>
                    
                    <div class="stat-card fade-in">
                        <div class="stat-icon" style="background: #f72585;">
                            <i class="bi bi-currency-rupee"></i>
                        </div>
                        <div class="stat-content">
                            <h3>₹${totalAmount}</h3>
                            <p>Total Amount</p>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Recent Class Requests</h5>
                            </div>
                            <div class="card-body">
                                ${classRequests.length > 0 ? `
                                <div class="table-container">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Student</th>
                                                <th>Item</th>
                                                <th>Quantity</th>
                                                <th>Date</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${classRequests.slice(0, 5).map(request => {
                                                const student = appState.data.students.find(s => s.id === request.studentId);
                                                return `
                                                <tr>
                                                    <td>${student ? student.name : 'Unknown'}</td>
                                                    <td>${request.itemName}</td>
                                                    <td>${request.quantity}</td>
                                                    <td>${request.date}</td>
                                                    <td><span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></td>
                                                </tr>
                                                `;
                                            }).join('')}
                                        </tbody>
                                    </table>
                                </div>
                                ` : '<p class="text-center py-4">No requests found for your class.</p>'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-primary w-100 mb-3" id="manageRequestsBtn">
                                    <i class="bi bi-clipboard-check me-2"></i> Manage Requests
                                </button>
                                <button class="btn btn-outline-primary w-100 mb-3" id="viewStudentsBtn">
                                    <i class="bi bi-people me-2"></i> View Students
                                </button>
                                <button class="btn btn-outline-secondary w-100" id="generateReportBtn">
                                    <i class="bi bi-graph-up me-2"></i> Generate Report
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Class Summary</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Class:</strong> ${teacherClass}</p>
                                <p><strong>Students:</strong> ${classStudents.length}</p>
                                <p><strong>Total Requests:</strong> ${classRequests.length}</p>
                                <p><strong>Amount Spent:</strong> ₹${totalAmount}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for buttons
            if (document.getElementById('manageRequestsBtn')) {
                document.getElementById('manageRequestsBtn').addEventListener('click', function() {
                    appState.currentPage = 'classRequests';
                    loadClassRequestsPage();
                });
            }
            
            if (document.getElementById('viewStudentsBtn')) {
                document.getElementById('viewStudentsBtn').addEventListener('click', function() {
                    appState.currentPage = 'classStudents';
                    loadClassStudentsPage();
                });
            }
            
            if (document.getElementById('generateReportBtn')) {
                document.getElementById('generateReportBtn').addEventListener('click', function() {
                    appState.currentPage = 'reports';
                    loadReportsPage();
                });
            }
        }

        // Load admin dashboard
        function loadAdminDashboard() {
            const content = document.getElementById('mainContent');
            
            // Calculate statistics
            const totalClasses = appState.data.classes.length;
            const totalStudents = appState.data.students.length;
            const totalRequests = appState.data.requests.length;
            const pendingRequests = appState.data.requests.filter(req => req.status === 'pending').length;
            const approvedRequests = appState.data.requests.filter(req => req.status === 'approved').length;
            const completedRequests = appState.data.requests.filter(req => req.status === 'completed').length;
            
            // Calculate total stock value
            const totalStockValue = appState.data.stationery.reduce(
                (sum, item) => sum + (item.price * item.stock), 0
            );
            
            // Calculate class-wise statistics
            const classStats = {};
            appState.data.classes.forEach(cls => {
                const classStudents = appState.data.students.filter(s => s.class === cls.name);
                const classRequests = appState.data.requests.filter(req => {
                    const student = appState.data.students.find(s => s.id === req.studentId);
                    return student && student.class === cls.name;
                });
                
                const classAmount = classRequests
                    .filter(req => req.status === 'completed')
                    .reduce((sum, req) => sum + (req.price * req.quantity), 0);
                
                classStats[cls.name] = {
                    students: classStudents.length,
                    requests: classRequests.length,
                    amount: classAmount
                };
            });
            
            content.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Admin Dashboard</h1>
                    <p class="page-subtitle">Comprehensive overview of stationery management</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card fade-in">
                        <div class="stat-icon" style="background: var(--gradient);">
                            <i class="bi bi-journal-text"></i>
                        </div>
                        <div class="stat-content">
                            <h3>${totalClasses}</h3>
                            <p>Total Classes</p>
                        </div>
                    </div>
                    
                    <div class="stat-card fade-in">
                        <div class="stat-icon" style="background: #4cc9f0;">
                            <i class="bi bi-people"></i>
                        </div>
                        <div class="stat-content">
                            <h3>${totalStudents}</h3>
                            <p>Total Students</p>
                        </div>
                    </div>
                    
                    <div class="stat-card fade-in">
                        <div class="stat-icon" style="background: #7209b7;">
                            <i class="bi bi-clipboard-check"></i>
                        </div>
                        <div class="stat-content">
                            <h3>${totalRequests}</h3>
                            <p>Total Requests</p>
                        </div>
                    </div>
                    
                    <div class="stat-card fade-in">
                        <div class="stat-icon" style="background: #f72585;">
                            <i class="bi bi-currency-rupee"></i>
                        </div>
                        <div class="stat-content">
                            <h3>₹${totalStockValue}</h3>
                            <p>Stock Value</p>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Request Status</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="requestsChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Class-wise Statistics</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-container">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Class</th>
                                                <th>Students</th>
                                                <th>Requests</th>
                                                <th>Amount</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${Object.keys(classStats).map(className => `
                                                <tr>
                                                    <td>${className}</td>
                                                    <td>${classStats[className].students}</td>
                                                    <td>${classStats[className].requests}</td>
                                                    <td>₹${classStats[className].amount}</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-primary w-100 mb-3" id="manageClassesBtn">
                                    <i class="bi bi-journal-text me-2"></i> Manage Classes
                                </button>
                                <button class="btn btn-outline-primary w-100 mb-3" id="manageStudentsBtn">
                                    <i class="bi bi-people me-2"></i> Manage Students
                                </button>
                                <button class="btn btn-outline-primary w-100 mb-3" id="manageRequestsBtn">
                                    <i class="bi bi-clipboard-check me-2"></i> Manage Requests
                                </button>
                                <button class="btn btn-outline-primary w-100 mb-3" id="manageInventoryBtn">
                                    <i class="bi bi-box-seam me-2"></i> Manage Inventory
                                </button>
                                <button class="btn btn-outline-secondary w-100" id="systemSettingsBtn">
                                    <i class="bi bi-gear me-2"></i> System Settings
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Low Stock Alerts</h5>
                            </div>
                            <div class="card-body">
                                ${appState.data.stationery.filter(item => item.stock < 10).length > 0 ? `
                                <div class="alert alert-warning">
                                    <i class="bi bi-exclamation-triangle me-2"></i>
                                    ${appState.data.stationery.filter(item => item.stock < 10).length} items are low in stock!
                                </div>
                                <ul class="list-group">
                                    ${appState.data.stationery.filter(item => item.stock < 10).map(item => `
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            ${item.name}
                                            <span class="badge bg-warning">${item.stock} left</span>
                                        </li>
                                    `).join('')}
                                </ul>
                                ` : '<p class="text-muted text-center">All items are sufficiently stocked</p>'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Render charts
            renderRequestStatusChart();
            
            // Add event listeners for buttons
            document.getElementById('manageClassesBtn').addEventListener('click', function() {
                appState.currentPage = 'classes';
                loadClassesPage();
            });
            
            document.getElementById('manageStudentsBtn').addEventListener('click', function() {
                appState.currentPage = 'students';
                loadStudentsPage();
            });
            
            document.getElementById('manageRequestsBtn').addEventListener('click', function() {
                appState.currentPage = 'requests';
                loadRequestsPage();
            });
            
            document.getElementById('manageInventoryBtn').addEventListener('click', function() {
                appState.currentPage = 'inventory';
                loadInventoryPage();
            });
            
            document.getElementById('systemSettingsBtn').addEventListener('click', function() {
                appState.currentPage = 'settings';
                loadSettingsPage();
            });
        }

        // Render request status chart
        function renderRequestStatusChart() {
            const ctx = document.getElementById('requestsChart').getContext('2d');
            const pending = appState.data.requests.filter(req => req.status === 'pending').length;
            const approved = appState.data.requests.filter(req => req.status === 'approved').length;
            const completed = appState.data.requests.filter(req => req.status === 'completed').length;
            const rejected = appState.data.requests.filter(req => req.status === 'rejected').length;
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Pending', 'Approved', 'Completed', 'Rejected'],
                    datasets: [{
                        data: [pending, approved, completed, rejected],
                        backgroundColor: [
                            '#4cc9f0',
                            '#7209b7',
                            '#4361ee',
                            '#f72585'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Show request modal
        function showRequestModal() {
            // Populate item dropdown
            const itemSelect = document.getElementById('itemSelect');
            itemSelect.innerHTML = '<option value="">Select an item</option>';
            
            appState.data.stationery.forEach(item => {
                if (item.stock > 0) {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = `${item.name} (${item.stock} available)`;
                    itemSelect.appendChild(option);
                }
            });
            
            // Reset form
            document.getElementById('requestForm').reset();
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('requestModal'));
            modal.show();
        }

        // Submit stationery request
        function submitRequest() {
            const itemId = document.getElementById('itemSelect').value;
            const quantity = parseInt(document.getElementById('quantity').value);
            const notes = document.getElementById('notes').value;
            
            if (!itemId || !quantity) {
                showToast('Please select an item and enter quantity.', 'warning');
                return;
            }
            
            const item = appState.data.stationery.find(i => i.id == itemId);
            
            if (quantity > item.stock) {
                showToast(`Only ${item.stock} items available in stock.`, 'warning');
                return;
            }
            
            // Create request
            const newRequest = {
                id: appState.data.requests.length + 1,
                studentId: appState.currentUser.id,
                itemId: itemId,
                itemName: item.name,
                quantity: quantity,
                date: new Date().toLocaleDateString(),
                status: 'pending',
                notes: notes,
                price: null
            };
            
            appState.data.requests.push(newRequest);
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('requestModal')).hide();
            
            // Show success message
            showToast('Stationery request submitted successfully!', 'success');
            
            // Reload dashboard
            loadDashboard();
        }

        // Show profile modal
        function showProfileModal() {
            // Populate profile data
            document.getElementById('profileName').value = appState.currentUser.name;
            document.getElementById('profileUsername').value = appState.currentUser.username;
            document.getElementById('profileRole').value = appState.currentRole.charAt(0).toUpperCase() + appState.currentRole.slice(1);
            document.getElementById('profileClass').value = appState.currentUser.class || 'N/A';
            
            // Reset password fields
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('profileModal'));
            modal.show();
        }

        // Update password
        function updatePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showToast('Please fill all password fields.', 'warning');
                return;
            }
            
            if (currentPassword !== appState.currentUser.password) {
                showToast('Current password is incorrect.', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('New passwords do not match.', 'error');
                return;
            }
            
            // Update password
            appState.currentUser.password = newPassword;
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('profileModal')).hide();
            
            // Show success message
            showToast('Password updated successfully!', 'success');
        }

        // Show settings modal
        function showSettingsModal() {
            // Populate settings
            document.getElementById('autoApprove').checked = appState.data.settings.autoApprove;
            document.getElementById('lowStockAlert').checked = appState.data.settings.lowStockAlert;
            document.getElementById('emailNotifications').checked = appState.data.settings.emailNotifications;
            document.getElementById('maxRequestsPerDay').value = appState.data.settings.maxRequestsPerDay;
            document.getElementById('maxAmountPerMonth').value = appState.data.settings.maxAmountPerMonth;
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('settingsModal'));
            modal.show();
        }

        // Save settings
        function saveSettings() {
            // Get settings values
            appState.data.settings.autoApprove = document.getElementById('autoApprove').checked;
            appState.data.settings.lowStockAlert = document.getElementById('lowStockAlert').checked;
            appState.data.settings.emailNotifications = document.getElementById('emailNotifications').checked;
            appState.data.settings.maxRequestsPerDay = parseInt(document.getElementById('maxRequestsPerDay').value);
            appState.data.settings.maxAmountPerMonth = parseInt(document.getElementById('maxAmountPerMonth').value);
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('settingsModal')).hide();
            
            // Show success message
            showToast('Settings saved successfully!', 'success');
        }

        // Load profile page
        function loadProfilePage() {
            const content = document.getElementById('mainContent');
            
            content.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">My Profile</h1>
                    <p class="page-subtitle">Manage your account information</p>
                </div>
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Profile Information</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-sm-3">
                                        <strong>Full Name:</strong>
                                    </div>
                                    <div class="col-sm-9">
                                        ${appState.currentUser.name}
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-sm-3">
                                        <strong>Username:</strong>
                                    </div>
                                    <div class="col-sm-9">
                                        ${appState.currentUser.username}
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-sm-3">
                                        <strong>Role:</strong>
                                    </div>
                                    <div class="col-sm-9">
                                        ${appState.currentRole.charAt(0).toUpperCase() + appState.currentRole.slice(1)}
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-sm-3">
                                        <strong>Class:</strong>
                                    </div>
                                    <div class="col-sm-9">
                                        ${appState.currentUser.class || 'N/A'}
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-sm-3">
                                        <strong>Member Since:</strong>
                                    </div>
                                    <div class="col-sm-9">
                                        ${new Date().toLocaleDateString()}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-primary w-100 mb-3" id="editProfileBtn">
                                    <i class="bi bi-pencil me-2"></i> Edit Profile
                                </button>
                                <button class="btn btn-outline-primary w-100 mb-3" id="changePasswordBtn">
                                    <i class="bi bi-shield-lock me-2"></i> Change Password
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Account Security</h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle me-2"></i>
                                    Last password change: ${new Date().toLocaleDateString()}
                                </div>
                                <p class="small text-muted">
                                    For security reasons, we recommend changing your password regularly.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners
            document.getElementById('editProfileBtn').addEventListener('click', showProfileModal);
            document.getElementById('changePasswordBtn').addEventListener('click', showProfileModal);
        }

        // Load my requests page
        function loadMyRequestsPage() {
            const content = document.getElementById('mainContent');
            
            // Get student's requests
            const studentRequests = appState.data.requests.filter(
                req => req.studentId === appState.currentUser.id
            );
            
            content.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">My Requests</h1>
                    <p class="page-subtitle">View and manage your stationery requests</p>
                </div>
                
                <div class="search-filter mb-4">
                    <div class="search-box">
                        <input type="text" class="form-control" placeholder="Search requests..." id="requestSearch">
                    </div>
                    <div class="filter-select">
                        <select class="form-control" id="statusFilter">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="completed">Completed</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <button class="btn btn-outline-secondary" id="advancedFilterToggle">
                        <i class="bi bi-funnel"></i> Advanced Filters
                    </button>
                </div>
                
                <div class="advanced-filter" id="advancedFilterPanel">
                    <div class="filter-header">
                        <h6 class="filter-title">Advanced Filters</h6>
                        <button type="button" class="btn-close" id="closeAdvancedFilter"></button>
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="form-label">Date From</label>
                            <input type="date" class="form-control" id="dateFromFilter">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Date To</label>
                            <input type="date" class="form-control" id="dateToFilter">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Item Category</label>
                            <select class="form-control" id="categoryFilter">
                                <option value="">All Categories</option>
                                <option value="Writing">Writing</option>
                                <option value="Notebook">Notebook</option>
                                <option value="Drawing">Drawing</option>
                                <option value="Files">Files</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button class="btn btn-secondary me-2" id="resetFilters">Reset</button>
                        <button class="btn btn-primary" id="applyFilters">Apply Filters</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">Request History</h5>
                        <button class="btn btn-primary" id="newRequestBtn">
                            <i class="bi bi-plus-circle me-2"></i> New Request
                        </button>
                    </div>
                    <div class="card-body">
                        ${studentRequests.length > 0 ? `
                        <div class="table-container">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Quantity</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Price</th>
                                        <th>Total</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="requestTableBody">
                                    ${studentRequests.map(request => `
                                        <tr>
                                            <td>${request.itemName}</td>
                                            <td>${request.quantity}</td>
                                            <td>${request.date}</td>
                                            <td><span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></td>
                                            <td>${request.price ? '₹' + request.price : '-'}</td>
                                            <td>${request.price ? '₹' + (request.price * request.quantity) : '-'}</td>
                                            <td>
                                                ${request.status === 'pending' ? `
                                                <button class="btn btn-sm btn-outline-danger delete-request" data-id="${request.id}">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                                ` : ''}
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        ` : `
                        <div class="text-center py-5">
                            <i class="bi bi-inbox display-1 text-muted"></i>
                            <h4 class="mt-3">No requests yet</h4>
                            <p class="text-muted">You haven't made any stationery requests yet.</p>
                            <button class="btn btn-primary mt-2" id="makeFirstRequest">Make your first request</button>
                        </div>
                        `}
                    </div>
                </div>
            `;
            
            // Add event listeners
            document.getElementById('newRequestBtn').addEventListener('click', showRequestModal);
            
            if (document.getElementById('makeFirstRequest')) {
                document.getElementById('makeFirstRequest').addEventListener('click', showRequestModal);
            }
            
            // Add event listeners for delete buttons
            document.querySelectorAll('.delete-request').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = parseInt(this.dataset.id);
                    deleteRequest(requestId);
                });
            });
            
            // Add advanced filter functionality
            setupAdvancedFilters('myRequests');
        }

        // Delete a request
        function deleteRequest(requestId) {
            if (confirm('Are you sure you want to delete this request?')) {
                const requestIndex = appState.data.requests.findIndex(req => req.id === requestId);
                
                if (requestIndex !== -1) {
                    appState.data.requests.splice(requestIndex, 1);
                    showToast('Request deleted successfully!', 'success');
                    loadMyRequestsPage();
                }
            }
        }

        // Setup advanced filters
        function setupAdvancedFilters(pageType) {
            // Toggle advanced filter panel
            document.getElementById('advancedFilterToggle').addEventListener('click', function() {
                const panel = document.getElementById('advancedFilterPanel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            });
            
            // Close advanced filter panel
            document.getElementById('closeAdvancedFilter').addEventListener('click', function() {
                document.getElementById('advancedFilterPanel').style.display = 'none';
            });
            
            // Apply filters
            document.getElementById('applyFilters').addEventListener('click', function() {
                applyFilters(pageType);
            });
            
            // Reset filters
            document.getElementById('resetFilters').addEventListener('click', function() {
                resetFilters(pageType);
            });
            
            // Search input
            document.getElementById('requestSearch').addEventListener('input', function() {
                applyFilters(pageType);
            });
            
            // Status filter
            document.getElementById('statusFilter').addEventListener('change', function() {
                applyFilters(pageType);
            });
        }

        // Apply filters
        function applyFilters(pageType) {
            const searchTerm = document.getElementById('requestSearch').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const dateFrom = document.getElementById('dateFromFilter').value;
            const dateTo = document.getElementById('dateToFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            let filteredData = [];
            
            switch(pageType) {
                case 'myRequests':
                    filteredData = appState.data.requests.filter(req => {
                        if (req.studentId !== appState.currentUser.id) return false;
                        
                        const matchesSearch = req.itemName.toLowerCase().includes(searchTerm);
                        const matchesStatus = !statusFilter || req.status === statusFilter;
                        const matchesDateFrom = !dateFrom || new Date(req.date) >= new Date(dateFrom);
                        const matchesDateTo = !dateTo || new Date(req.date) <= new Date(dateTo);
                        
                        // For category, we need to find the item
                        const item = appState.data.stationery.find(i => i.id === req.itemId);
                        const matchesCategory = !categoryFilter || (item && item.category === categoryFilter);
                        
                        return matchesSearch && matchesStatus && matchesDateFrom && matchesDateTo && matchesCategory;
                    });
                    break;
                // Add cases for other pages as needed
            }
            
            // Update table with filtered data
            const tableBody = document.getElementById('requestTableBody');
            tableBody.innerHTML = filteredData.map(request => {
                return `
                <tr>
                    <td>${request.itemName}</td>
                    <td>${request.quantity}</td>
                    <td>${request.date}</td>
                    <td><span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></td>
                    <td>${request.price ? '₹' + request.price : '-'}</td>
                    <td>${request.price ? '₹' + (request.price * request.quantity) : '-'}</td>
                    <td>
                        ${request.status === 'pending' ? `
                        <button class="btn btn-sm btn-outline-danger delete-request" data-id="${request.id}">
                            <i class="bi bi-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
                `;
            }).join('');
            
            // Reattach event listeners for delete buttons
            document.querySelectorAll('.delete-request').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = parseInt(this.dataset.id);
                    deleteRequest(requestId);
                });
            });
        }

        // Reset filters
        function resetFilters(pageType) {
            document.getElementById('requestSearch').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('dateFromFilter').value = '';
            document.getElementById('dateToFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            
            applyFilters(pageType);
        }

        // Load classes page (admin only)
        function loadClassesPage() {
            const content = document.getElementById('mainContent');
            
            content.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Manage Classes</h1>
                    <p class="page-subtitle">Add, edit, and manage classes</p>
                </div>
                
                <div class="search-filter mb-4">
                    <div class="search-box">
                        <input type="text" class="form-control" placeholder="Search classes..." id="classSearch">
                    </div>
                    <button class="btn btn-outline-secondary" id="advancedFilterToggle">
                        <i class="bi bi-funnel"></i> Advanced Filters
                    </button>
                </div>
                
                <div class="advanced-filter" id="advancedFilterPanel">
                    <div class="filter-header">
                        <h6 class="filter-title">Advanced Filters</h6>
                        <button type="button" class="btn-close" id="closeAdvancedFilter"></button>
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="form-label">Teacher Name</label>
                            <input type="text" class="form-control" id="teacherFilter">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Min Students</label>
                            <input type="number" class="form-control" id="minStudentsFilter" min="0">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Max Students</label>
                            <input type="number" class="form-control" id="maxStudentsFilter" min="0">
                        </div>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button class="btn btn-secondary me-2" id="resetFilters">Reset</button>
                        <button class="btn btn-primary" id="applyFilters">Apply Filters</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">All Classes</h5>
                        <button class="btn btn-primary" id="addClassBtn">
                            <i class="bi bi-plus-circle me-2"></i> Add Class
                        </button>
                    </div>
                    <div class="card-body">
                        ${appState.data.classes.length > 0 ? `
                        <div class="table-container">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Class Name</th>
                                        <th>Class Teacher</th>
                                        <th>Students</th>
                                        <th>Total Requests</th>
                                        <th>Amount</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="classTableBody">
                                    ${appState.data.classes.map(cls => {
                                        const classStudents = appState.data.students.filter(s => s.class === cls.name);
                                        const classRequests = appState.data.requests.filter(req => {
                                            const student = appState.data.students.find(s => s.id === req.studentId);
                                            return student && student.class === cls.name;
                                        });
                                        
                                        const classAmount = classRequests
                                            .filter(req => req.status === 'completed')
                                            .reduce((sum, req) => sum + (req.price * req.quantity), 0);
                                        
                                        return `
                                        <tr>
                                            <td>${cls.name}</td>
                                            <td>${cls.teacher}</td>
                                            <td>${classStudents.length}</td>
                                            <td>${classRequests.length}</td>
                                            <td>₹${classAmount}</td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary edit-class" data-id="${cls.id}">
                                                    <i class="bi bi-pencil"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger delete-class" data-id="${cls.id}">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                        ` : `
                        <div class="text-center py-5">
                            <i class="bi bi-journal-text display-1 text-muted"></i>
                            <h4 class="mt-3">No classes yet</h4>
                            <p class="text-muted">You haven't added any classes yet.</p>
                            <button class="btn btn-primary mt-2" id="addFirstClass">Add your first class</button>
                        </div>
                        `}
                    </div>
                </div>
            `;
            
            // Add event listeners
            document.getElementById('addClassBtn').addEventListener('click', function() {
                showClassModal();
            });
            
            if (document.getElementById('addFirstClass')) {
                document.getElementById('addFirstClass').addEventListener('click', function() {
                    showClassModal();
                });
            }
            
            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-class').forEach(button => {
                button.addEventListener('click', function() {
                    const classId = parseInt(this.dataset.id);
                    editClass(classId);
                });
            });
            
            document.querySelectorAll('.delete-class').forEach(button => {
                button.addEventListener('click', function() {
                    const classId = parseInt(this.dataset.id);
                    deleteClass(classId);
                });
            });
            
            // Add advanced filter functionality
            setupClassFilters();
        }

        // Setup class filters
        function setupClassFilters() {
            // Toggle advanced filter panel
            document.getElementById('advancedFilterToggle').addEventListener('click', function() {
                const panel = document.getElementById('advancedFilterPanel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            });
            
            // Close advanced filter panel
            document.getElementById('closeAdvancedFilter').addEventListener('click', function() {
                document.getElementById('advancedFilterPanel').style.display = 'none';
            });
            
            // Apply filters
            document.getElementById('applyFilters').addEventListener('click', function() {
                applyClassFilters();
            });
            
            // Reset filters
            document.getElementById('resetFilters').addEventListener('click', function() {
                resetClassFilters();
            });
            
            // Search input
            document.getElementById('classSearch').addEventListener('input', function() {
                applyClassFilters();
            });
        }

        // Apply class filters
        function applyClassFilters() {
            const searchTerm = document.getElementById('classSearch').value.toLowerCase();
            const teacherFilter = document.getElementById('teacherFilter').value.toLowerCase();
            const minStudents = parseInt(document.getElementById('minStudentsFilter').value) || 0;
            const maxStudents = parseInt(document.getElementById('maxStudentsFilter').value) || Infinity;
            
            const filteredClasses = appState.data.classes.filter(cls => {
                const classStudents = appState.data.students.filter(s => s.class === cls.name);
                const studentCount = classStudents.length;
                
                const matchesSearch = cls.name.toLowerCase().includes(searchTerm) || 
                                     cls.teacher.toLowerCase().includes(searchTerm);
                const matchesTeacher = !teacherFilter || cls.teacher.toLowerCase().includes(teacherFilter);
                const matchesMinStudents = studentCount >= minStudents;
                const matchesMaxStudents = studentCount <= maxStudents;
                
                return matchesSearch && matchesTeacher && matchesMinStudents && matchesMaxStudents;
            });
            
            const tableBody = document.getElementById('classTableBody');
            tableBody.innerHTML = filteredClasses.map(cls => {
                const classStudents = appState.data.students.filter(s => s.class === cls.name);
                const classRequests = appState.data.requests.filter(req => {
                    const student = appState.data.students.find(s => s.id === req.studentId);
                    return student && student.class === cls.name;
                });
                
                const classAmount = classRequests
                    .filter(req => req.status === 'completed')
                    .reduce((sum, req) => sum + (req.price * req.quantity), 0);
                
                return `
                <tr>
                    <td>${cls.name}</td>
                    <td>${cls.teacher}</td>
                    <td>${classStudents.length}</td>
                    <td>${classRequests.length}</td>
                    <td>₹${classAmount}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary edit-class" data-id="${cls.id}">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger delete-class" data-id="${cls.id}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                </tr>
                `;
            }).join('');
            
            // Reattach event listeners
            document.querySelectorAll('.edit-class').forEach(button => {
                button.addEventListener('click', function() {
                    const classId = parseInt(this.dataset.id);
                    editClass(classId);
                });
            });
            
            document.querySelectorAll('.delete-class').forEach(button => {
                button.addEventListener('click', function() {
                    const classId = parseInt(this.dataset.id);
                    deleteClass(classId);
                });
            });
        }

        // Reset class filters
        function resetClassFilters() {
            document.getElementById('classSearch').value = '';
            document.getElementById('teacherFilter').value = '';
            document.getElementById('minStudentsFilter').value = '';
            document.getElementById('maxStudentsFilter').value = '';
            
            applyClassFilters();
        }

        // Show class modal
        function showClassModal(isEdit = false, classData = null) {
            const modalTitle = document.getElementById('classModalTitle');
            const modal = new bootstrap.Modal(document.getElementById('classModal'));
            
            if (isEdit && classData) {
                modalTitle.textContent = 'Edit Class';
                document.getElementById('classId').value = classData.id;
                document.getElementById('className').value = classData.name;
                document.getElementById('classTeacher').value = classData.teacher;
                document.getElementById('teacherUsername').value = classData.teacherUsername || '';
                document.getElementById('teacherPassword').value = classData.teacherPassword || '';
                document.getElementById('teacherEmail').value = classData.teacherEmail || '';
            } else {
                modalTitle.textContent = 'Add Class';
                document.getElementById('classForm').reset();
                document.getElementById('classId').value = '';
            }
            
            modal.show();
        }

        // Edit class
        function editClass(classId) {
            const classData = appState.data.classes.find(cls => cls.id === classId);
            if (classData) {
                showClassModal(true, classData);
            }
        }

        // Delete class
        function deleteClass(classId) {
            if (confirm('Are you sure you want to delete this class? This will also remove all students in this class.')) {
                const classIndex = appState.data.classes.findIndex(cls => cls.id === classId);
                
                if (classIndex !== -1) {
                    const className = appState.data.classes[classIndex].name;
                    
                    // Remove class
                    appState.data.classes.splice(classIndex, 1);
                    
                    // Remove students in this class
                    appState.data.students = appState.data.students.filter(s => s.class !== className);
                    
                    showToast('Class deleted successfully!', 'success');
                    loadClassesPage();
                }
            }
        }

        // Save class
        function saveClass() {
            const classId = document.getElementById('classId').value;
            const className = document.getElementById('className').value;
            const classTeacher = document.getElementById('classTeacher').value;
            const teacherUsername = document.getElementById('teacherUsername').value;
            const teacherPassword = document.getElementById('teacherPassword').value;
            const teacherEmail = document.getElementById('teacherEmail').value;
            
            if (!className || !classTeacher || !teacherUsername || !teacherPassword || !teacherEmail) {
                showToast('Please fill all required fields.', 'warning');
                return;
            }
            
            if (classId) {
                // Update existing class
                const classIndex = appState.data.classes.findIndex(cls => cls.id == classId);
                if (classIndex !== -1) {
                    appState.data.classes[classIndex].name = className;
                    appState.data.classes[classIndex].teacher = classTeacher;
                    appState.data.classes[classIndex].teacherUsername = teacherUsername;
                    appState.data.classes[classIndex].teacherPassword = teacherPassword;
                    appState.data.classes[classIndex].teacherEmail = teacherEmail;
                }
            } else {
                // Add new class
                const newClass = {
                    id: appState.data.classes.length + 1,
                    name: className,
                    teacher: classTeacher,
                    teacherUsername: teacherUsername,
                    teacherPassword: teacherPassword,
                    teacherEmail: teacherEmail
                };
                
                appState.data.classes.push(newClass);
            }
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('classModal')).hide();
            
            // Show success message
            showToast(`Class ${classId ? 'updated' : 'added'} successfully!`, 'success');
            
            // Reload classes page
            loadClassesPage();
        }

        // Load students page (admin only)
        function loadStudentsPage() {
            const content = document.getElementById('mainContent');
            
            content.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Manage Students</h1>
                    <p class="page-subtitle">Add, edit, and manage students</p>
                </div>
                
                <div class="search-filter mb-4">
                    <div class="search-box">
                        <input type="text" class="form-control" placeholder="Search students..." id="studentSearch">
                    </div>
                    <div class="filter-select">
                        <select class="form-control" id="classFilter">
                            <option value="">All Classes</option>
                            ${appState.data.classes.map(cls => `
                                <option value="${cls.name}">${cls.name}</option>
                            `).join('')}
                        </select>
                    </div>
                    <button class="btn btn-outline-secondary" id="advancedFilterToggle">
                        <i class="bi bi-funnel"></i> Advanced Filters
                    </button>
                </div>
                
                <div class="advanced-filter" id="advancedFilterPanel">
                    <div class="filter-header">
                        <h6 class="filter-title">Advanced Filters</h6>
                        <button type="button" class="btn-close" id="closeAdvancedFilter"></button>
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="form-label">Admission No</label>
                            <input type="text" class="form-control" id="admissionNoFilter">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Min Requests</label>
                            <input type="number" class="form-control" id="minRequestsFilter" min="0">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Max Requests</label>
                            <input type="number" class="form-control" id="maxRequestsFilter" min="0">
                        </div>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button class="btn btn-secondary me-2" id="resetFilters">Reset</button>
                        <button class="btn btn-primary" id="applyFilters">Apply Filters</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">All Students</h5>
                        <button class="btn btn-primary" id="addStudentBtn">
                            <i class="bi bi-plus-circle me-2"></i> Add Student
                        </button>
                    </div>
                    <div class="card-body">
                        ${appState.data.students.length > 0 ? `
                        <div class="table-container">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Admission No</th>
                                        <th>Name</th>
                                        <th>Username</th>
                                        <th>Class</th>
                                        <th>Requests</th>
                                        <th>Amount</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="studentTableBody">
                                    ${appState.data.students.map(student => {
                                        const studentRequests = appState.data.requests.filter(req => req.studentId === student.id);
                                        const studentAmount = studentRequests
                                            .filter(req => req.status === 'completed')
                                            .reduce((sum, req) => sum + (req.price * req.quantity), 0);
                                        
                                        return `
                                        <tr>
                                            <td>${student.admissionNo}</td>
                                            <td>${student.name}</td>
                                            <td>${student.username}</td>
                                            <td>${student.class}</td>
                                            <td>${studentRequests.length}</td>
                                            <td>₹${studentAmount}</td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary edit-student" data-id="${student.id}">
                                                    <i class="bi bi-pencil"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger delete-student" data-id="${student.id}">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-secondary reset-password" data-id="${student.id}">
                                                    <i class="bi bi-key"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                        ` : `
                        <div class="text-center py-5">
                            <i class="bi bi-people display-1 text-muted"></i>
                            <h4 class="mt-3">No students yet</h4>
                            <p class="text-muted">You haven't added any students yet.</p>
                            <button class="btn btn-primary mt-2" id="addFirstStudent">Add your first student</button>
                        </div>
                        `}
                    </div>
                </div>
            `;
            
            // Add event listeners
            document.getElementById('addStudentBtn').addEventListener('click', function() {
                showStudentModal();
            });
            
            if (document.getElementById('addFirstStudent')) {
                document.getElementById('addFirstStudent').addEventListener('click', function() {
                    showStudentModal();
                });
            }
            
            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-student').forEach(button => {
                button.addEventListener('click', function() {
                    const studentId = parseInt(this.dataset.id);
                    editStudent(studentId);
                });
            });
            
            document.querySelectorAll('.delete-student').forEach(button => {
                button.addEventListener('click', function() {
                    const studentId = parseInt(this.dataset.id);
                    deleteStudent(studentId);
                });
            });
            
            document.querySelectorAll('.reset-password').forEach(button => {
                button.addEventListener('click', function() {
                    const studentId = parseInt(this.dataset.id);
                    resetStudentPassword(studentId);
                });
            });
            
            // Add search and filter functionality
            setupStudentFilters();
        }

        // Setup student filters
        function setupStudentFilters() {
            // Toggle advanced filter panel
            document.getElementById('advancedFilterToggle').addEventListener('click', function() {
                const panel = document.getElementById('advancedFilterPanel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            });
            
            // Close advanced filter panel
            document.getElementById('closeAdvancedFilter').addEventListener('click', function() {
                document.getElementById('advancedFilterPanel').style.display = 'none';
            });
            
            // Apply filters
            document.getElementById('applyFilters').addEventListener('click', function() {
                applyStudentFilters();
            });
            
            // Reset filters
            document.getElementById('resetFilters').addEventListener('click', function() {
                resetStudentFilters();
            });
            
            // Search input
            document.getElementById('studentSearch').addEventListener('input', function() {
                applyStudentFilters();
            });
            
            // Class filter
            document.getElementById('classFilter').addEventListener('change', function() {
                applyStudentFilters();
            });
        }

        // Apply student filters
        function applyStudentFilters() {
            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
            const classFilter = document.getElementById('classFilter').value;
            const admissionNoFilter = document.getElementById('admissionNoFilter').value.toLowerCase();
            const minRequests = parseInt(document.getElementById('minRequestsFilter').value) || 0;
            const maxRequests = parseInt(document.getElementById('maxRequestsFilter').value) || Infinity;
            
            const filteredStudents = appState.data.students.filter(student => {
                const studentRequests = appState.data.requests.filter(req => req.studentId === student.id);
                const requestCount = studentRequests.length;
                
                const matchesSearch = student.name.toLowerCase().includes(searchTerm) || 
                                     student.username.toLowerCase().includes(searchTerm);
                const matchesClass = !classFilter || student.class === classFilter;
                const matchesAdmissionNo = !admissionNoFilter || student.admissionNo.toLowerCase().includes(admissionNoFilter);
                const matchesMinRequests = requestCount >= minRequests;
                const matchesMaxRequests = requestCount <= maxRequests;
                
                return matchesSearch && matchesClass && matchesAdmissionNo && matchesMinRequests && matchesMaxRequests;
            });
            
            const tableBody = document.getElementById('studentTableBody');
            tableBody.innerHTML = filteredStudents.map(student => {
                const studentRequests = appState.data.requests.filter(req => req.studentId === student.id);
                const studentAmount = studentRequests
                    .filter(req => req.status === 'completed')
                    .reduce((sum, req) => sum + (req.price * req.quantity), 0);
                
                return `
                <tr>
                    <td>${student.admissionNo}</td>
                    <td>${student.name}</td>
                    <td>${student.username}</td>
                    <td>${student.class}</td>
                    <td>${studentRequests.length}</td>
                    <td>₹${studentAmount}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary edit-student" data-id="${student.id}">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger delete-student" data-id="${student.id}">
                            <i class="bi bi-trash"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-secondary reset-password" data-id="${student.id}">
                            <i class="bi bi-key"></i>
                        </button>
                    </td>
                </tr>
                `;
            }).join('');
            
            // Reattach event listeners
            document.querySelectorAll('.edit-student').forEach(button => {
                button.addEventListener('click', function() {
                    const studentId = parseInt(this.dataset.id);
                    editStudent(studentId);
                });
            });
            
            document.querySelectorAll('.delete-student').forEach(button => {
                button.addEventListener('click', function() {
                    const studentId = parseInt(this.dataset.id);
                    deleteStudent(studentId);
                });
            });
            
            document.querySelectorAll('.reset-password').forEach(button => {
                button.addEventListener('click', function() {
                    const studentId = parseInt(this.dataset.id);
                    resetStudentPassword(studentId);
                });
            });
        }

        // Reset student filters
        function resetStudentFilters() {
            document.getElementById('studentSearch').value = '';
            document.getElementById('classFilter').value = '';
            document.getElementById('admissionNoFilter').value = '';
            document.getElementById('minRequestsFilter').value = '';
            document.getElementById('maxRequestsFilter').value = '';
            
            applyStudentFilters();
        }

        // Show student modal
        function showStudentModal(isEdit = false, studentData = null) {
            const modalTitle = document.getElementById('studentModalTitle');
            const modal = new bootstrap.Modal(document.getElementById('studentModal'));
            
            // Populate class dropdown
            const classSelect = document.getElementById('studentClass');
            classSelect.innerHTML = '<option value="">Select a class</option>';
            
            appState.data.classes.forEach(cls => {
                const option = document.createElement('option');
                option.value = cls.name;
                option.textContent = cls.name;
                classSelect.appendChild(option);
            });
            
            if (isEdit && studentData) {
                modalTitle.textContent = 'Edit Student';
                document.getElementById('studentId').value = studentData.id;
                document.getElementById('admissionNo').value = studentData.admissionNo;
                document.getElementById('studentName').value = studentData.name;
                document.getElementById('studentClass').value = studentData.class;
                document.getElementById('studentUsername').value = studentData.username;
                document.getElementById('studentPassword').value = studentData.password;
                document.getElementById('studentEmail').value = studentData.email || '';
            } else {
                modalTitle.textContent = 'Add Student';
                document.getElementById('studentForm').reset();
                document.getElementById('studentId').value = '';
            }
            
            modal.show();
        }

        // Edit student
        function editStudent(studentId) {
            const studentData = appState.data.students.find(s => s.id === studentId);
            if (studentData) {
                showStudentModal(true, studentData);
            }
        }

        // Delete student
        function deleteStudent(studentId) {
            if (confirm('Are you sure you want to delete this student? This will also remove all their requests.')) {
                const studentIndex = appState.data.students.findIndex(s => s.id === studentId);
                
                if (studentIndex !== -1) {
                    // Remove student
                    appState.data.students.splice(studentIndex, 1);
                    
                    // Remove student's requests
                    appState.data.requests = appState.data.requests.filter(req => req.studentId !== studentId);
                    
                    showToast('Student deleted successfully!', 'success');
                    loadStudentsPage();
                }
            }
        }

        // Reset student password
        function resetStudentPassword(studentId) {
            if (confirm('Are you sure you want to reset this student\'s password? The new password will be "password".')) {
                const student = appState.data.students.find(s => s.id === studentId);
                if (student) {
                    student.password = 'password';
                    showToast('Password reset successfully!', 'success');
                }
            }
        }

        // Save student
        function saveStudent() {
            const studentId = document.getElementById('studentId').value;
            const admissionNo = document.getElementById('admissionNo').value;
            const studentName = document.getElementById('studentName').value;
            const studentClass = document.getElementById('studentClass').value;
            const studentUsername = document.getElementById('studentUsername').value;
            const studentPassword = document.getElementById('studentPassword').value;
            const studentEmail = document.getElementById('studentEmail').value;
            
            if (!admissionNo || !studentName || !studentClass || !studentUsername || !studentPassword) {
                showToast('Please fill all required fields.', 'warning');
                return;
            }
            
            if (studentId) {
                // Update existing student
                const studentIndex = appState.data.students.findIndex(s => s.id == studentId);
                if (studentIndex !== -1) {
                    appState.data.students[studentIndex].admissionNo = admissionNo;
                    appState.data.students[studentIndex].name = studentName;
                    appState.data.students[studentIndex].class = studentClass;
                    appState.data.students[studentIndex].username = studentUsername;
                    appState.data.students[studentIndex].password = studentPassword;
                    appState.data.students[studentIndex].email = studentEmail;
                }
            } else {
                // Add new student
                const newStudent = {
                    id: appState.data.students.length + 1,
                    admissionNo: admissionNo,
                    name: studentName,
                    class: studentClass,
                    username: studentUsername,
                    password: studentPassword,
                    email: studentEmail
                };
                
                appState.data.students.push(newStudent);
            }
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('studentModal')).hide();
            
            // Show success message
            showToast(`Student ${studentId ? 'updated' : 'added'} successfully!`, 'success');
            
            // Reload students page
            loadStudentsPage();
        }

        // Load requests page (admin only)
        function loadRequestsPage() {
            const content = document.getElementById('mainContent');
            
            content.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Stationery Requests</h1>
                    <p class="page-subtitle">Manage and approve stationery requests</p>
                </div>
                
                <div class="search-filter mb-4">
                    <div class="search-box">
                        <input type="text" class="form-control" placeholder="Search requests..." id="requestSearch">
                    </div>
                    <div class="filter-select">
                        <select class="form-control" id="statusFilter">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="completed">Completed</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <div class="filter-select">
                        <select class="form-control" id="classFilter">
                            <option value="">All Classes</option>
                            ${appState.data.classes.map(cls => `
                                <option value="${cls.name}">${cls.name}</option>
                            `).join('')}
                        </select>
                    </div>
                    <button class="btn btn-outline-secondary" id="advancedFilterToggle">
                        <i class="bi bi-funnel"></i> Advanced Filters
                    </button>
                </div>
                
                <div class="advanced-filter" id="advancedFilterPanel">
                    <div class="filter-header">
                        <h6 class="filter-title">Advanced Filters</h6>
                        <button type="button" class="btn-close" id="closeAdvancedFilter"></button>
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="form-label">Date From</label>
                            <input type="date" class="form-control" id="dateFromFilter">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Date To</label>
                            <input type="date" class="form-control" id="dateToFilter">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Item Category</label>
                            <select class="form-control" id="categoryFilter">
                                <option value="">All Categories</option>
                                <option value="Writing">Writing</option>
                                <option value="Notebook">Notebook</option>
                                <option value="Drawing">Drawing</option>
                                <option value="Files">Files</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="form-label">Min Quantity</label>
                            <input type="number" class="form-control" id="minQuantityFilter" min="1">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Max Quantity</label>
                            <input type="number" class="form-control" id="maxQuantityFilter" min="1">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Min Amount</label>
                            <input type="number" class="form-control" id="minAmountFilter" min="0">
                        </div>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button class="btn btn-secondary me-2" id="resetFilters">Reset</button>
                        <button class="btn btn-primary" id="applyFilters">Apply Filters</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">All Requests</h5>
                    </div>
                    <div class="card-body">
                        ${appState.data.requests.length > 0 ? `
                        <div class="table-container">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Student</th>
                                        <th>Class</th>
                                        <th>Item</th>
                                        <th>Quantity</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Price</th>
                                        <th>Total</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="requestTableBody">
                                    ${appState.data.requests.map(request => {
                                        const student = appState.data.students.find(s => s.id === request.studentId);
                                        return `
                                        <tr>
                                            <td>${student ? student.name : 'Unknown'}</td>
                                            <td>${student ? student.class : 'N/A'}</td>
                                            <td>${request.itemName}</td>
                                            <td>${request.quantity}</td>
                                            <td>${request.date}</td>
                                            <td><span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></td>
                                            <td>${request.price ? '₹' + request.price : '-'}</td>
                                            <td>${request.price ? '₹' + (request.price * request.quantity) : '-'}</td>
                                            <td>
                                                ${request.status === 'pending' ? `
                                                <button class="btn btn-sm btn-outline-success approve-request" data-id="${request.id}">
                                                    <i class="bi bi-check"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger reject-request" data-id="${request.id}">
                                                    <i class="bi bi-x"></i>
                                                </button>
                                                ` : ''}
                                                
                                                ${request.status === 'approved' ? `
                                                <button class="btn btn-sm btn-outline-primary complete-request" data-id="${request.id}">
                                                    <i class="bi bi-check-circle"></i>
                                                </button>
                                                ` : ''}
                                            </td>
                                        </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                        ` : `
                        <div class="text-center py-5">
                            <i class="bi bi-clipboard-check display-1 text-muted"></i>
                            <h4 class="mt-3">No requests yet</h4>
                            <p class="text-muted">No stationery requests have been made yet.</p>
                        </div>
                        `}
                    </div>
                </div>
            `;
            
            // Add event listeners for action buttons
            document.querySelectorAll('.approve-request').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = parseInt(this.dataset.id);
                    approveRequest(requestId);
                });
            });
            
            document.querySelectorAll('.reject-request').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = parseInt(this.dataset.id);
                    rejectRequest(requestId);
                });
            });
            
            document.querySelectorAll('.complete-request').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = parseInt(this.dataset.id);
                    completeRequest(requestId);
                });
            });
            
            // Add advanced filter functionality
            setupRequestFilters();
        }

        // Setup request filters
        function setupRequestFilters() {
            // Toggle advanced filter panel
            document.getElementById('advancedFilterToggle').addEventListener('click', function() {
                const panel = document.getElementById('advancedFilterPanel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            });
            
            // Close advanced filter panel
            document.getElementById('closeAdvancedFilter').addEventListener('click', function() {
                document.getElementById('advancedFilterPanel').style.display = 'none';
            });
            
            // Apply filters
            document.getElementById('applyFilters').addEventListener('click', function() {
                applyRequestFilters();
            });
            
            // Reset filters
            document.getElementById('resetFilters').addEventListener('click', function() {
                resetRequestFilters();
            });
            
            // Search input
            document.getElementById('requestSearch').addEventListener('input', function() {
                applyRequestFilters();
            });
            
            // Status filter
            document.getElementById('statusFilter').addEventListener('change', function() {
                applyRequestFilters();
            });
            
            // Class filter
            document.getElementById('classFilter').addEventListener('change', function() {
                applyRequestFilters();
            });
        }

        // Apply request filters
        function applyRequestFilters() {
            const searchTerm = document.getElementById('requestSearch').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const classFilter = document.getElementById('classFilter').value;
            const dateFrom = document.getElementById('dateFromFilter').value;
            const dateTo = document.getElementById('dateToFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const minQuantity = parseInt(document.getElementById('minQuantityFilter').value) || 0;
            const maxQuantity = parseInt(document.getElementById('maxQuantityFilter').value) || Infinity;
            const minAmount = parseInt(document.getElementById('minAmountFilter').value) || 0;
            
            const filteredRequests = appState.data.requests.filter(request => {
                const student = appState.data.students.find(s => s.id === request.studentId);
                const item = appState.data.stationery.find(i => i.id === request.itemId);
                const amount = request.price ? request.price * request.quantity : 0;
                
                const matchesSearch = student && (
                    student.name.toLowerCase().includes(searchTerm) || 
                    request.itemName.toLowerCase().includes(searchTerm)
                );
                const matchesStatus = !statusFilter || request.status === statusFilter;
                const matchesClass = !classFilter || (student && student.class === classFilter);
                const matchesDateFrom = !dateFrom || new Date(request.date) >= new Date(dateFrom);
                const matchesDateTo = !dateTo || new Date(request.date) <= new Date(dateTo);
                const matchesCategory = !categoryFilter || (item && item.category === categoryFilter);
                const matchesMinQuantity = request.quantity >= minQuantity;
                const matchesMaxQuantity = request.quantity <= maxQuantity;
                const matchesMinAmount = amount >= minAmount;
                
                return matchesSearch && matchesStatus && matchesClass && matchesDateFrom && 
                       matchesDateTo && matchesCategory && matchesMinQuantity && 
                       matchesMaxQuantity && matchesMinAmount;
            });
            
            const tableBody = document.getElementById('requestTableBody');
            tableBody.innerHTML = filteredRequests.map(request => {
                const student = appState.data.students.find(s => s.id === request.studentId);
                return `
                <tr>
                    <td>${student ? student.name : 'Unknown'}</td>
                    <td>${student ? student.class : 'N/A'}</td>
                    <td>${request.itemName}</td>
                    <td>${request.quantity}</td>
                    <td>${request.date}</td>
                    <td><span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></td>
                    <td>${request.price ? '₹' + request.price : '-'}</td>
                    <td>${request.price ? '₹' + (request.price * request.quantity) : '-'}</td>
                    <td>
                        ${request.status === 'pending' ? `
                        <button class="btn btn-sm btn-outline-success approve-request" data-id="${request.id}">
                            <i class="bi bi-check"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger reject-request" data-id="${request.id}">
                            <i class="bi bi-x"></i>
                        </button>
                        ` : ''}
                        
                        ${request.status === 'approved' ? `
                        <button class="btn btn-sm btn-outline-primary complete-request" data-id="${request.id}">
                            <i class="bi bi-check-circle"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
                `;
            }).join('');
            
            // Reattach event listeners
            document.querySelectorAll('.approve-request').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = parseInt(this.dataset.id);
                    approveRequest(requestId);
                });
            });
            
            document.querySelectorAll('.reject-request').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = parseInt(this.dataset.id);
                    rejectRequest(requestId);
                });
            });
            
            document.querySelectorAll('.complete-request').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = parseInt(this.dataset.id);
                    completeRequest(requestId);
                });
            });
        }

        // Reset request filters
        function resetRequestFilters() {
            document.getElementById('requestSearch').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('classFilter').value = '';
            document.getElementById('dateFromFilter').value = '';
            document.getElementById('dateToFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('minQuantityFilter').value = '';
            document.getElementById('maxQuantityFilter').value = '';
            document.getElementById('minAmountFilter').value = '';
            
            applyRequestFilters();
        }

        // Approve request
        function approveRequest(requestId) {
            const request = appState.data.requests.find(req => req.id === requestId);
            if (request) {
                const item = appState.data.stationery.find(i => i.name === request.itemName);
                if (item) {
                    // Set price from item
                    request.price = item.price;
                    request.status = 'approved';
                    
                    // Reduce stock
                    item.stock -= request.quantity;
                    
                    showToast('Request approved successfully!', 'success');
                    loadRequestsPage();
                }
            }
        }

        // Reject request
        function rejectRequest(requestId) {
            if (confirm('Are you sure you want to reject this request?')) {
                const request = appState.data.requests.find(req => req.id === requestId);
                if (request) {
                    request.status = 'rejected';
                    showToast('Request rejected!', 'success');
                    loadRequestsPage();
                }
            }
        }

        // Complete request
        function completeRequest(requestId) {
            const request = appState.data.requests.find(req => req.id === requestId);
            if (request) {
                request.status = 'completed';
                showToast('Request marked as completed!', 'success');
                loadRequestsPage();
            }
        }

        // Load inventory page (admin only)
        function loadInventoryPage() {
            const content = document.getElementById('mainContent');
            
            content.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Inventory Management</h1>
                    <p class="page-subtitle">Manage stationery items and stock levels</p>
                </div>
                
                <div class="search-filter mb-4">
                    <div class="search-box">
                        <input type="text" class="form-control" placeholder="Search items..." id="itemSearch">
                    </div>
                    <div class="filter-select">
                        <select class="form-control" id="categoryFilter">
                            <option value="">All Categories</option>
                            <option value="Writing">Writing</option>
                            <option value="Notebook">Notebook</option>
                            <option value="Drawing">Drawing</option>
                            <option value="Files">Files</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <button class="btn btn-outline-secondary" id="advancedFilterToggle">
                        <i class="bi bi-funnel"></i> Advanced Filters
                    </button>
                </div>
                
                <div class="advanced-filter" id="advancedFilterPanel">
                    <div class="filter-header">
                        <h6 class="filter-title">Advanced Filters</h6>
                        <button type="button" class="btn-close" id="closeAdvancedFilter"></button>
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="form-label">Min Price</label>
                            <input type="number" class="form-control" id="minPriceFilter" min="0" step="0.01">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Max Price</label>
                            <input type="number" class="form-control" id="maxPriceFilter" min="0" step="0.01">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Min Stock</label>
                            <input type="number" class="form-control" id="minStockFilter" min="0">
                        </div>
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="form-label">Max Stock</label>
                            <input type="number" class="form-control" id="maxStockFilter" min="0">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Stock Status</label>
                            <select class="form-control" id="stockStatusFilter">
                                <option value="">All</option>
                                <option value="low">Low Stock</option>
                                <option value="sufficient">Sufficient Stock</option>
                                <option value="out">Out of Stock</option>
                            </select>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button class="btn btn-secondary me-2" id="resetFilters">Reset</button>
                        <button class="btn btn-primary" id="applyFilters">Apply Filters</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">Stationery Items</h5>
                        <button class="btn btn-primary" id="addItemBtn">
                            <i class="bi bi-plus-circle me-2"></i> Add Item
                        </button>
                    </div>
                    <div class="card-body">
                        ${appState.data.stationery.length > 0 ? `
                        <div class="table-container">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Item Name</th>
                                        <th>Category</th>
                                        <th>Price</th>
                                        <th>Stock</th>
                                        <th>Stock Value</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="itemTableBody">
                                    ${appState.data.stationery.map(item => {
                                        const stockValue = item.price * item.stock;
                                        const isLowStock = item.stock < 10;
                                        const isOutOfStock = item.stock === 0;
                                        
                                        return `
                                        <tr>
                                            <td>${item.name}</td>
                                            <td>${item.category}</td>
                                            <td>₹${item.price}</td>
                                            <td>${item.stock}</td>
                                            <td>₹${stockValue}</td>
                                            <td>
                                                <span class="badge ${isOutOfStock ? 'badge-danger' : isLowStock ? 'badge-warning' : 'badge-success'}">
                                                    ${isOutOfStock ? 'Out of Stock' : isLowStock ? 'Low Stock' : 'In Stock'}
                                                </span>
                                            </td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary edit-item" data-id="${item.id}">
                                                    <i class="bi bi-pencil"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger delete-item" data-id="${item.id}">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                        ` : `
                        <div class="text-center py-5">
                            <i class="bi bi-box-seam display-1 text-muted"></i>
                            <h4 class="mt-3">No items yet</h4>
                            <p class="text-muted">You haven't added any stationery items yet.</p>
                            <button class="btn btn-primary mt-2" id="addFirstItem">Add your first item</button>
                        </div>
                        `}
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Stock Summary</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="stockChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Low Stock Alerts</h5>
                            </div>
                            <div class="card-body">
                                ${appState.data.stationery.filter(item => item.stock < 10).length > 0 ? `
                                <div class="alert alert-warning">
                                    <i class="bi bi-exclamation-triangle me-2"></i>
                                    ${appState.data.stationery.filter(item => item.stock < 10).length} items are low in stock!
                                </div>
                                <ul class="list-group">
                                    ${appState.data.stationery.filter(item => item.stock < 10).map(item => `
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            ${item.name}
                                            <span class="badge bg-warning">${item.stock} left</span>
                                        </li>
                                    `).join('')}
                                </ul>
                                ` : '<p class="text-muted text-center">All items are sufficiently stocked</p>'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners
            document.getElementById('addItemBtn').addEventListener('click', function() {
                showItemModal();
            });
            
            if (document.getElementById('addFirstItem')) {
                document.getElementById('addFirstItem').addEventListener('click', function() {
                    showItemModal();
                });
            }
            
            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-item').forEach(button => {
                button.addEventListener('click', function() {
                    const itemId = parseInt(this.dataset.id);
                    editItem(itemId);
                });
            });
            
            document.querySelectorAll('.delete-item').forEach(button => {
                button.addEventListener('click', function() {
                    const itemId = parseInt(this.dataset.id);
                    deleteItem(itemId);
                });
            });
            
            // Add advanced filter functionality
            setupInventoryFilters();
            
            // Render stock chart
            renderStockChart();
        }

        // Setup inventory filters
        function setupInventoryFilters() {
            // Toggle advanced filter panel
            document.getElementById('advancedFilterToggle').addEventListener('click', function() {
                const panel = document.getElementById('advancedFilterPanel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            });
            
            // Close advanced filter panel
            document.getElementById('closeAdvancedFilter').addEventListener('click', function() {
                document.getElementById('advancedFilterPanel').style.display = 'none';
            });
            
            // Apply filters
            document.getElementById('applyFilters').addEventListener('click', function() {
                applyInventoryFilters();
            });
            
            // Reset filters
            document.getElementById('resetFilters').addEventListener('click', function() {
                resetInventoryFilters();
            });
            
            // Search input
            document.getElementById('itemSearch').addEventListener('input', function() {
                applyInventoryFilters();
            });
            
            // Category filter
            document.getElementById('categoryFilter').addEventListener('change', function() {
                applyInventoryFilters();
            });
        }

        // Apply inventory filters
        function applyInventoryFilters() {
            const searchTerm = document.getElementById('itemSearch').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const minPrice = parseFloat(document.getElementById('minPriceFilter').value) || 0;
            const maxPrice = parseFloat(document.getElementById('maxPriceFilter').value) || Infinity;
            const minStock = parseInt(document.getElementById('minStockFilter').value) || 0;
            const maxStock = parseInt(document.getElementById('maxStockFilter').value) || Infinity;
            const stockStatusFilter = document.getElementById('stockStatusFilter').value;
            
            const filteredItems = appState.data.stationery.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || item.category === categoryFilter;
                const matchesMinPrice = item.price >= minPrice;
                const matchesMaxPrice = item.price <= maxPrice;
                const matchesMinStock = item.stock >= minStock;
                const matchesMaxStock = item.stock <= maxStock;
                
                let matchesStockStatus = true;
                if (stockStatusFilter === 'low') {
                    matchesStockStatus = item.stock < 10 && item.stock > 0;
                } else if (stockStatusFilter === 'sufficient') {
                    matchesStockStatus = item.stock >= 10;
                } else if (stockStatusFilter === 'out') {
                    matchesStockStatus = item.stock === 0;
                }
                
                return matchesSearch && matchesCategory && matchesMinPrice && 
                       matchesMaxPrice && matchesMinStock && matchesMaxStock && matchesStockStatus;
            });
            
            const tableBody = document.getElementById('itemTableBody');
            tableBody.innerHTML = filteredItems.map(item => {
                const stockValue = item.price * item.stock;
                const isLowStock = item.stock < 10;
                const isOutOfStock = item.stock === 0;
                
                return `
                <tr>
                    <td>${item.name}</td>
                    <td>${item.category}</td>
                    <td>₹${item.price}</td>
                    <td>${item.stock}</td>
                    <td>₹${stockValue}</td>
                    <td>
                        <span class="badge ${isOutOfStock ? 'badge-danger' : isLowStock ? 'badge-warning' : 'badge-success'}">
                            ${isOutOfStock ? 'Out of Stock' : isLowStock ? 'Low Stock' : 'In Stock'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary edit-item" data-id="${item.id}">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger delete-item" data-id="${item.id}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                </tr>
                `;
            }).join('');
            
            // Reattach event listeners
            document.querySelectorAll('.edit-item').forEach(button => {
                button.addEventListener('click', function() {
                    const itemId = parseInt(this.dataset.id);
                    editItem(itemId);
                });
            });
            
            document.querySelectorAll('.delete-item').forEach(button => {
                button.addEventListener('click', function() {
                    const itemId = parseInt(this.dataset.id);
                    deleteItem(itemId);
                });
            });
        }

        // Reset inventory filters
        function resetInventoryFilters() {
            document.getElementById('itemSearch').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('minPriceFilter').value = '';
            document.getElementById('maxPriceFilter').value = '';
            document.getElementById('minStockFilter').value = '';
            document.getElementById('maxStockFilter').value = '';
            document.getElementById('stockStatusFilter').value = '';
            
            applyInventoryFilters();
        }

        // Show item modal
        function showItemModal(isEdit = false, itemData = null) {
            const modalTitle = document.getElementById('itemModalTitle');
            const modal = new bootstrap.Modal(document.getElementById('itemModal'));
            
            if (isEdit && itemData) {
                modalTitle.textContent = 'Edit Item';
                document.getElementById('itemId').value = itemData.id;
                document.getElementById('itemName').value = itemData.name;
                document.getElementById('itemCategory').value = itemData.category;
                document.getElementById('itemPrice').value = itemData.price;
                document.getElementById('itemStock').value = itemData.stock;
                document.getElementById('itemDescription').value = itemData.description || '';
            } else {
                modalTitle.textContent = 'Add Item';
                document.getElementById('itemForm').reset();
                document.getElementById('itemId').value = '';
            }
            
            modal.show();
        }

        // Edit item
        function editItem(itemId) {
            const itemData = appState.data.stationery.find(item => item.id === itemId);
            if (itemData) {
                showItemModal(true, itemData);
            }
        }

        // Delete item
        function deleteItem(itemId) {
            if (confirm('Are you sure you want to delete this item?')) {
                const itemIndex = appState.data.stationery.findIndex(item => item.id === itemId);
                
                if (itemIndex !== -1) {
                    appState.data.stationery.splice(itemIndex, 1);
                    showToast('Item deleted successfully!', 'success');
                    loadInventoryPage();
                }
            }
        }

        // Save item
        function saveItem() {
            const itemId = document.getElementById('itemId').value;
            const itemName = document.getElementById('itemName').value;
            const itemCategory = document.getElementById('itemCategory').value;
            const itemPrice = parseFloat(document.getElementById('itemPrice').value);
            const itemStock = parseInt(document.getElementById('itemStock').value);
            const itemDescription = document.getElementById('itemDescription').value;
            
            if (!itemName || !itemCategory || !itemPrice || !itemStock) {
                showToast('Please fill all required fields.', 'warning');
                return;
            }
            
            if (itemId) {
                // Update existing item
                const itemIndex = appState.data.stationery.findIndex(item => item.id == itemId);
                if (itemIndex !== -1) {
                    appState.data.stationery[itemIndex].name = itemName;
                    appState.data.stationery[itemIndex].category = itemCategory;
                    appState.data.stationery[itemIndex].price = itemPrice;
                    appState.data.stationery[itemIndex].stock = itemStock;
                    appState.data.stationery[itemIndex].description = itemDescription;
                }
            } else {
                // Add new item
                const newItem = {
                    id: appState.data.stationery.length + 1,
                    name: itemName,
                    category: itemCategory,
                    price: itemPrice,
                    stock: itemStock,
                    description: itemDescription
                };
                
                appState.data.stationery.push(newItem);
            }
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('itemModal')).hide();
            
            // Show success message
            showToast(`Item ${itemId ? 'updated' : 'added'} successfully!`, 'success');
            
            // Reload inventory page
            loadInventoryPage();
        }

        // Render stock chart
        function renderStockChart() {
            const ctx = document.getElementById('stockChart').getContext('2d');
            
            const categories = [...new Set(appState.data.stationery.map(item => item.category))];
            const categoryData = categories.map(category => {
                const itemsInCategory = appState.data.stationery.filter(item => item.category === category);
                return itemsInCategory.reduce((sum, item) => sum + item.stock, 0);
            });
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: categories,
                    datasets: [{
                        label: 'Stock by Category',
                        data: categoryData,
                        backgroundColor: [
                            '#4361ee',
                            '#4cc9f0',
                            '#7209b7',
                            '#f72585',
                            '#3a0ca3'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Quantity'
                            }
                        }
                    }
                }
            });
        }

        // Load reports page
        function loadReportsPage() {
            const content = document.getElementById('mainContent');
            const isAdmin = appState.currentRole === 'admin';
            const isTeacher = appState.currentRole === 'teacher';
            
            let classFilterOptions = '';
            if (isAdmin) {
                classFilterOptions = `
                    <option value="">All Classes</option>
                    ${appState.data.classes.map(cls => `
                        <option value="${cls.name}">${cls.name}</option>
                    `).join('')}
                `;
            } else if (isTeacher) {
                classFilterOptions = `
                    <option value="${appState.currentUser.class}">${appState.currentUser.class}</option>
                `;
            }
            
            content.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Reports & Analytics</h1>
                    <p class="page-subtitle">Generate and export reports</p>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title">Report Filters</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label">Date From</label>
                                    <input type="date" class="form-control" id="dateFrom">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label">Date To</label>
                                    <input type="date" class="form-control" id="dateTo">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label">Class</label>
                                    <select class="form-control" id="reportClassFilter">
                                        ${classFilterOptions}
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label">Report Type</label>
                                    <select class="form-control" id="reportType">
                                        <option value="requests">Requests Report</option>
                                        <option value="inventory">Inventory Report</option>
                                        <option value="students">Students Report</option>
                                        ${isAdmin ? '<option value="classes">Classes Report</option>' : ''}
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="export-buttons mt-3">
                            <button class="btn btn-success" id="generateReportBtn">
                                <i class="bi bi-graph-up me-2"></i> Generate Report
                            </button>
                            <button class="btn btn-outline-primary" id="exportPdfBtn">
                                <i class="bi bi-file-pdf me-2"></i> Export PDF
                            </button>
                            <button class="btn btn-outline-success" id="exportExcelBtn">
                                <i class="bi bi-file-earmark-excel me-2"></i> Export Excel
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Report Results</h5>
                    </div>
                    <div class="card-body">
                        <div id="reportResults" class="text-center py-5">
                            <i class="bi bi-graph-up display-1 text-muted"></i>
                            <h4 class="mt-3">No report generated yet</h4>
                            <p class="text-muted">Use the filters above to generate a report.</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners
            document.getElementById('generateReportBtn').addEventListener('click', generateReport);
            document.getElementById('exportPdfBtn').addEventListener('click', function() {
                showToast('PDF export functionality would be implemented in a real application.', 'info');
            });
            document.getElementById('exportExcelBtn').addEventListener('click', function() {
                showToast('Excel export functionality would be implemented in a real application.', 'info');
            });
        }

        // Generate report
        function generateReport() {
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            const classFilter = document.getElementById('reportClassFilter').value;
            const reportType = document.getElementById('reportType').value;
            
            let reportData = [];
            let reportTitle = '';
            
            switch(reportType) {
                case 'requests':
                    reportTitle = 'Stationery Requests Report';
                    reportData = generateRequestsReport(dateFrom, dateTo, classFilter);
                    break;
                case 'inventory':
                    reportTitle = 'Inventory Report';
                    reportData = generateInventoryReport();
                    break;
                case 'students':
                    reportTitle = 'Students Report';
                    reportData = generateStudentsReport(classFilter);
                    break;
                case 'classes':
                    reportTitle = 'Classes Report';
                    reportData = generateClassesReport();
                    break;
            }
            
            displayReportResults(reportTitle, reportData, reportType);
        }

        // Generate requests report
        function generateRequestsReport(dateFrom, dateTo, classFilter) {
            let filteredRequests = [...appState.data.requests];
            
            // Filter by class if specified
            if (classFilter) {
                filteredRequests = filteredRequests.filter(request => {
                    const student = appState.data.students.find(s => s.id === request.studentId);
                    return student && student.class === classFilter;
                });
            }
            
            // In a real app, we would filter by date as well
            
            return filteredRequests;
        }

        // Generate inventory report
        function generateInventoryReport() {
            return appState.data.stationery;
        }

        // Generate students report
        function generateStudentsReport(classFilter) {
            let filteredStudents = [...appState.data.students];
            
            // Filter by class if specified
            if (classFilter) {
                filteredStudents = filteredStudents.filter(student => student.class === classFilter);
            }
            
            return filteredStudents;
        }

        // Generate classes report
        function generateClassesReport() {
            return appState.data.classes.map(cls => {
                const classStudents = appState.data.students.filter(s => s.class === cls.name);
                const classRequests = appState.data.requests.filter(request => {
                    const student = appState.data.students.find(s => s.id === request.studentId);
                    return student && student.class === cls.name;
                });
                
                const classAmount = classRequests
                    .filter(req => req.status === 'completed')
                    .reduce((sum, req) => sum + (req.price * req.quantity), 0);
                
                return {
                    ...cls,
                    studentCount: classStudents.length,
                    requestCount: classRequests.length,
                    totalAmount: classAmount
                };
            });
        }

        // Display report results
        function displayReportResults(title, data, reportType) {
            const reportResults = document.getElementById('reportResults');
            
            if (data.length === 0) {
                reportResults.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-search display-1 text-muted"></i>
                        <h4 class="mt-3">No data found</h4>
                        <p class="text-muted">No records match your filter criteria.</p>
                    </div>
                `;
                return;
            }
            
            let tableHTML = '';
            
            switch(reportType) {
                case 'requests':
                    tableHTML = `
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Student</th>
                                    <th>Class</th>
                                    <th>Item</th>
                                    <th>Quantity</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Price</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.map(request => {
                                    const student = appState.data.students.find(s => s.id === request.studentId);
                                    return `
                                    <tr>
                                        <td>${student ? student.name : 'Unknown'}</td>
                                        <td>${student ? student.class : 'N/A'}</td>
                                        <td>${request.itemName}</td>
                                        <td>${request.quantity}</td>
                                        <td>${request.date}</td>
                                        <td><span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></td>
                                        <td>${request.price ? '₹' + request.price : '-'}</td>
                                        <td>${request.price ? '₹' + (request.price * request.quantity) : '-'}</td>
                                    </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    `;
                    break;
                    
                case 'inventory':
                    tableHTML = `
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Item Name</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Stock</th>
                                    <th>Stock Value</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.map(item => {
                                    const stockValue = item.price * item.stock;
                                    const isLowStock = item.stock < 10;
                                    
                                    return `
                                    <tr>
                                        <td>${item.name}</td>
                                        <td>${item.category}</td>
                                        <td>₹${item.price}</td>
                                        <td>${item.stock}</td>
                                        <td>₹${stockValue}</td>
                                        <td>
                                            <span class="badge ${isLowStock ? 'badge-warning' : 'badge-success'}">
                                                ${isLowStock ? 'Low Stock' : 'In Stock'}
                                            </span>
                                        </td>
                                    </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    `;
                    break;
                    
                case 'students':
                    tableHTML = `
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Admission No</th>
                                    <th>Name</th>
                                    <th>Class</th>
                                    <th>Requests</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.map(student => {
                                    const studentRequests = appState.data.requests.filter(req => req.studentId === student.id);
                                    const studentAmount = studentRequests
                                        .filter(req => req.status === 'completed')
                                        .reduce((sum, req) => sum + (req.price * req.quantity), 0);
                                    
                                    return `
                                    <tr>
                                        <td>${student.admissionNo}</td>
                                        <td>${student.name}</td>
                                        <td>${student.class}</td>
                                        <td>${studentRequests.length}</td>
                                        <td>₹${studentAmount}</td>
                                    </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    `;
                    break;
                    
                case 'classes':
                    tableHTML = `
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Class Name</th>
                                    <th>Class Teacher</th>
                                    <th>Students</th>
                                    <th>Requests</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.map(cls => `
                                    <tr>
                                        <td>${cls.name}</td>
                                        <td>${cls.teacher}</td>
                                        <td>${cls.studentCount}</td>
                                        <td>${cls.requestCount}</td>
                                        <td>₹${cls.totalAmount}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    break;
            }
            
            reportResults.innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4>${title}</h4>
                    <div>
                        <span class="badge bg-primary">${data.length} records</span>
                    </div>
                </div>
                <div class="table-container">
                    ${tableHTML}
                </div>
            `;
        }

        // Load settings page
        function loadSettingsPage() {
            const content = document.getElementById('mainContent');
            
            content.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">System Settings</h1>
                    <p class="page-subtitle">Configure application settings and preferences</p>
                </div>
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">General Settings</h5>
                            </div>
                            <div class="card-body">
                                <div class="settings-section">
                                    <h6 class="settings-title">Application Settings</h6>
                                    <div class="settings-card">
                                        <div class="form-group d-flex justify-content-between align-items-center">
                                            <label for="autoApproveSetting" class="form-label mb-0">Auto-approve requests under ₹100</label>
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="autoApproveSetting" ${appState.data.settings.autoApprove ? 'checked' : ''}>
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                        <div class="form-group d-flex justify-content-between align-items-center mt-3">
                                            <label for="lowStockAlertSetting" class="form-label mb-0">Low stock alerts</label>
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="lowStockAlertSetting" ${appState.data.settings.lowStockAlert ? 'checked' : ''}>
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                        <div class="form-group d-flex justify-content-between align-items-center mt-3">
                                            <label for="emailNotificationsSetting" class="form-label mb-0">Email notifications</label>
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="emailNotificationsSetting" ${appState.data.settings.emailNotifications ? 'checked' : ''}>
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="settings-section">
                                    <h6 class="settings-title">Request Limits</h6>
                                    <div class="settings-card">
                                        <div class="form-group">
                                            <label for="maxRequestsPerDaySetting" class="form-label">Max requests per day per student</label>
                                            <input type="number" class="form-control" id="maxRequestsPerDaySetting" value="${appState.data.settings.maxRequestsPerDay}">
                                        </div>
                                        <div class="form-group">
                                            <label for="maxAmountPerMonthSetting" class="form-label">Max amount per month per student (₹)</label>
                                            <input type="number" class="form-control" id="maxAmountPerMonthSetting" value="${appState.data.settings.maxAmountPerMonth}">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="settings-section">
                                    <h6 class="settings-title">System Information</h6>
                                    <div class="settings-card">
                                        <div class="form-group">
                                            <label class="form-label">System Version</label>
                                            <input type="text" class="form-control" value="v2.1.0" readonly>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Last Backup</label>
                                            <input type="text" class="form-control" value="2023-11-15 02:30 AM" readonly>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Database Size</label>
                                            <input type="text" class="form-control" value="24.5 MB" readonly>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-end mt-4">
                                    <button class="btn btn-primary" id="saveAllSettings">
                                        <i class="bi bi-check-circle me-2"></i> Save All Settings
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <button class="btn btn-outline-primary w-100 mb-3" id="backupDataBtn">
                                    <i class="bi bi-cloud-arrow-up me-2"></i> Backup Data
                                </button>
                                <button class="btn btn-outline-secondary w-100 mb-3" id="systemLogsBtn">
                                    <i class="bi bi-journal-text me-2"></i> System Logs
                                </button>
                                <button class="btn btn-outline-info w-100 mb-3" id="userActivityBtn">
                                    <i class="bi bi-activity me-2"></i> User Activity
                                </button>
                                <button class="btn btn-outline-warning w-100" id="maintenanceBtn">
                                    <i class="bi bi-tools me-2"></i> Maintenance
                                </button>
                            </div>
                        </div>
                        
                        <div class="card mt-4">
                            <div class="card-header">
                                <h5 class="card-title">Recent Activity</h5>
                            </div>
                            <div class="card-body">
                                <div class="activity-log">
                                    <div class="log-item">
                                        <div class="log-icon bg-primary">
                                            <i class="bi bi-person"></i>
                                        </div>
                                        <div class="log-content">
                                            <div>New student registered</div>
                                            <div class="log-time">2 hours ago</div>
                                        </div>
                                    </div>
                                    <div class="log-item">
                                        <div class="log-icon bg-success">
                                            <i class="bi bi-check-circle"></i>
                                        </div>
                                        <div class="log-content">
                                            <div>Request approved</div>
                                            <div class="log-time">5 hours ago</div>
                                        </div>
                                    </div>
                                    <div class="log-item">
                                        <div class="log-icon bg-warning">
                                            <i class="bi bi-exclamation-triangle"></i>
                                        </div>
                                        <div class="log-content">
                                            <div>Low stock alert</div>
                                            <div class="log-time">1 day ago</div>
                                        </div>
                                    </div>
                                    <div class="log-item">
                                        <div class="log-icon bg-info">
                                            <i class="bi bi-download"></i>
                                        </div>
                                        <div class="log-content">
                                            <div>Report generated</div>
                                            <div class="log-time">2 days ago</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners
            document.getElementById('saveAllSettings').addEventListener('click', function() {
                // Save settings
                appState.data.settings.autoApprove = document.getElementById('autoApproveSetting').checked;
                appState.data.settings.lowStockAlert = document.getElementById('lowStockAlertSetting').checked;
                appState.data.settings.emailNotifications = document.getElementById('emailNotificationsSetting').checked;
                appState.data.settings.maxRequestsPerDay = parseInt(document.getElementById('maxRequestsPerDaySetting').value);
                appState.data.settings.maxAmountPerMonth = parseInt(document.getElementById('maxAmountPerMonthSetting').value);
                
                showToast('All settings saved successfully!', 'success');
            });
            
            document.getElementById('backupDataBtn').addEventListener('click', function() {
                showToast('Data backup initiated. This may take a few minutes.', 'info');
            });
            
            document.getElementById('systemLogsBtn').addEventListener('click', function() {
                showToast('System logs would open in a new window in a real application.', 'info');
            });
            
            document.getElementById('userActivityBtn').addEventListener('click', function() {
                showToast('User activity report would be generated in a real application.', 'info');
            });
            
            document.getElementById('maintenanceBtn').addEventListener('click', function() {
                showToast('Maintenance mode would be activated in a real application.', 'info');
            });
        }

        // Load class requests page (teacher only)
        function loadClassRequestsPage() {
            const content = document.getElementById('mainContent');
            
            // Get teacher's class
            const teacherClass = appState.currentUser.class;
            
            // Get requests from teacher's class
            const classRequests = appState.data.requests.filter(request => {
                const student = appState.data.students.find(s => s.id === request.studentId);
                return student && student.class === teacherClass;
            });
            
            content.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Class Requests</h1>
                    <p class="page-subtitle">Manage stationery requests for ${teacherClass}</p>
                </div>
                
                <div class="search-filter mb-4">
                    <div class="search-box">
                        <input type="text" class="form-control" placeholder="Search requests..." id="classRequestSearch">
                    </div>
                    <div class="filter-select">
                        <select class="form-control" id="classRequestStatusFilter">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="completed">Completed</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <button class="btn btn-outline-secondary" id="advancedFilterToggle">
                        <i class="bi bi-funnel"></i> Advanced Filters
                    </button>
                </div>
                
                <div class="advanced-filter" id="advancedFilterPanel">
                    <div class="filter-header">
                        <h6 class="filter-title">Advanced Filters</h6>
                        <button type="button" class="btn-close" id="closeAdvancedFilter"></button>
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="form-label">Date From</label>
                            <input type="date" class="form-control" id="dateFromFilter">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Date To</label>
                            <input type="date" class="form-control" id="dateToFilter">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Item Category</label>
                            <select class="form-control" id="categoryFilter">
                                <option value="">All Categories</option>
                                <option value="Writing">Writing</option>
                                <option value="Notebook">Notebook</option>
                                <option value="Drawing">Drawing</option>
                                <option value="Files">Files</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button class="btn btn-secondary me-2" id="resetFilters">Reset</button>
                        <button class="btn btn-primary" id="applyFilters">Apply Filters</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Class Requests</h5>
                    </div>
                    <div class="card-body">
                        ${classRequests.length > 0 ? `
                        <div class="table-container">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Student</th>
                                        <th>Item</th>
                                        <th>Quantity</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Price</th>
                                        <th>Total</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="classRequestTableBody">
                                    ${classRequests.map(request => {
                                        const student = appState.data.students.find(s => s.id === request.studentId);
                                        return `
                                        <tr>
                                            <td>${student ? student.name : 'Unknown'}</td>
                                            <td>${request.itemName}</td>
                                            <td>${request.quantity}</td>
                                            <td>${request.date}</td>
                                            <td><span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></td>
                                            <td>${request.price ? '₹' + request.price : '-'}</td>
                                            <td>${request.price ? '₹' + (request.price * request.quantity) : '-'}</td>
                                            <td>
                                                ${request.status === 'pending' ? `
                                                <button class="btn btn-sm btn-outline-success approve-request" data-id="${request.id}">
                                                    <i class="bi bi-check"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger reject-request" data-id="${request.id}">
                                                    <i class="bi bi-x"></i>
                                                </button>
                                                ` : ''}
                                                
                                                ${request.status === 'approved' ? `
                                                <button class="btn btn-sm btn-outline-primary complete-request" data-id="${request.id}">
                                                    <i class="bi bi-check-circle"></i>
                                                </button>
                                                ` : ''}
                                            </td>
                                        </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                        ` : `
                        <div class="text-center py-5">
                            <i class="bi bi-clipboard-check display-1 text-muted"></i>
                            <h4 class="mt-3">No requests yet</h4>
                            <p class="text-muted">No stationery requests have been made by students in your class.</p>
                        </div>
                        `}
                    </div>
                </div>
            `;
            
            // Add event listeners for action buttons
            document.querySelectorAll('.approve-request').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = parseInt(this.dataset.id);
                    approveRequest(requestId);
                });
            });
            
            document.querySelectorAll('.reject-request').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = parseInt(this.dataset.id);
                    rejectRequest(requestId);
                });
            });
            
            document.querySelectorAll('.complete-request').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = parseInt(this.dataset.id);
                    completeRequest(requestId);
                });
            });
            
            // Add advanced filter functionality
            setupClassRequestFilters();
        }

        // Setup class request filters
        function setupClassRequestFilters() {
            // Toggle advanced filter panel
            document.getElementById('advancedFilterToggle').addEventListener('click', function() {
                const panel = document.getElementById('advancedFilterPanel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            });
            
            // Close advanced filter panel
            document.getElementById('closeAdvancedFilter').addEventListener('click', function() {
                document.getElementById('advancedFilterPanel').style.display = 'none';
            });
            
            // Apply filters
            document.getElementById('applyFilters').addEventListener('click', function() {
                applyClassRequestFilters();
            });
            
            // Reset filters
            document.getElementById('resetFilters').addEventListener('click', function() {
                resetClassRequestFilters();
            });
            
            // Search input
            document.getElementById('classRequestSearch').addEventListener('input', function() {
                applyClassRequestFilters();
            });
            
            // Status filter
            document.getElementById('classRequestStatusFilter').addEventListener('change', function() {
                applyClassRequestFilters();
            });
        }

        // Apply class request filters
        function applyClassRequestFilters() {
            const searchTerm = document.getElementById('classRequestSearch').value.toLowerCase();
            const statusFilter = document.getElementById('classRequestStatusFilter').value;
            const dateFrom = document.getElementById('dateFromFilter').value;
            const dateTo = document.getElementById('dateToFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            // Get teacher's class
            const teacherClass = appState.currentUser.class;
            
            const filteredRequests = appState.data.requests.filter(request => {
                const student = appState.data.students.find(s => s.id === request.studentId);
                const item = appState.data.stationery.find(i => i.id === request.itemId);
                
                const isInClass = student && student.class === teacherClass;
                const matchesSearch = student && (
                    student.name.toLowerCase().includes(searchTerm) || 
                    request.itemName.toLowerCase().includes(searchTerm)
                );
                const matchesStatus = !statusFilter || request.status === statusFilter;
                const matchesDateFrom = !dateFrom || new Date(request.date) >= new Date(dateFrom);
                const matchesDateTo = !dateTo || new Date(request.date) <= new Date(dateTo);
                const matchesCategory = !categoryFilter || (item && item.category === categoryFilter);
                
                return isInClass && matchesSearch && matchesStatus && matchesDateFrom && matchesDateTo && matchesCategory;
            });
            
            const tableBody = document.getElementById('classRequestTableBody');
            tableBody.innerHTML = filteredRequests.map(request => {
                const student = appState.data.students.find(s => s.id === request.studentId);
                return `
                <tr>
                    <td>${student ? student.name : 'Unknown'}</td>
                    <td>${request.itemName}</td>
                    <td>${request.quantity}</td>
                    <td>${request.date}</td>
                    <td><span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></td>
                    <td>${request.price ? '₹' + request.price : '-'}</td>
                    <td>${request.price ? '₹' + (request.price * request.quantity) : '-'}</td>
                    <td>
                        ${request.status === 'pending' ? `
                        <button class="btn btn-sm btn-outline-success approve-request" data-id="${request.id}">
                            <i class="bi bi-check"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger reject-request" data-id="${request.id}">
                            <i class="bi bi-x"></i>
                        </button>
                        ` : ''}
                        
                        ${request.status === 'approved' ? `
                        <button class="btn btn-sm btn-outline-primary complete-request" data-id="${request.id}">
                            <i class="bi bi-check-circle"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
                `;
            }).join('');
            
            // Reattach event listeners
            document.querySelectorAll('.approve-request').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = parseInt(this.dataset.id);
                    approveRequest(requestId);
                });
            });
            
            document.querySelectorAll('.reject-request').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = parseInt(this.dataset.id);
                    rejectRequest(requestId);
                });
            });
            
            document.querySelectorAll('.complete-request').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = parseInt(this.dataset.id);
                    completeRequest(requestId);
                });
            });
        }

        // Reset class request filters
        function resetClassRequestFilters() {
            document.getElementById('classRequestSearch').value = '';
            document.getElementById('classRequestStatusFilter').value = '';
            document.getElementById('dateFromFilter').value = '';
            document.getElementById('dateToFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            
            applyClassRequestFilters();
        }

        // Load class students page (teacher only)
        function loadClassStudentsPage() {
            const content = document.getElementById('mainContent');
            
            // Get teacher's class
            const teacherClass = appState.currentUser.class;
            
            // Get students in teacher's class
            const classStudents = appState.data.students.filter(
                student => student.class === teacherClass
            );
            
            content.innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Class Students</h1>
                    <p class="page-subtitle">View students in ${teacherClass}</p>
                </div>
                
                <div class="search-filter mb-4">
                    <div class="search-box">
                        <input type="text" class="form-control" placeholder="Search students..." id="classStudentSearch">
                    </div>
                    <button class="btn btn-outline-secondary" id="advancedFilterToggle">
                        <i class="bi bi-funnel"></i> Advanced Filters
                    </button>
                </div>
                
                <div class="advanced-filter" id="advancedFilterPanel">
                    <div class="filter-header">
                        <h6 class="filter-title">Advanced Filters</h6>
                        <button type="button" class="btn-close" id="closeAdvancedFilter"></button>
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="form-label">Admission No</label>
                            <input type="text" class="form-control" id="admissionNoFilter">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Min Requests</label>
                            <input type="number" class="form-control" id="minRequestsFilter" min="0">
                        </div>
                        <div class="filter-group">
                            <label class="form-label">Max Requests</label>
                            <input type="number" class="form-control" id="maxRequestsFilter" min="0">
                        </div>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button class="btn btn-secondary me-2" id="resetFilters">Reset</button>
                        <button class="btn btn-primary" id="applyFilters">Apply Filters</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Class Students</h5>
                    </div>
                    <div class="card-body">
                        ${classStudents.length > 0 ? `
                        <div class="table-container">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Admission No</th>
                                        <th>Name</th>
                                        <th>Username</th>
                                        <th>Requests</th>
                                        <th>Amount</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="classStudentTableBody">
                                    ${classStudents.map(student => {
                                        const studentRequests = appState.data.requests.filter(req => req.studentId === student.id);
                                        const studentAmount = studentRequests
                                            .filter(req => req.status === 'completed')
                                            .reduce((sum, req) => sum + (req.price * req.quantity), 0);
                                        
                                        return `
                                        <tr>
                                            <td>${student.admissionNo}</td>
                                            <td>${student.name}</td>
                                            <td>${student.username}</td>
                                            <td>${studentRequests.length}</td>
                                            <td>₹${studentAmount}</td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-secondary reset-password" data-id="${student.id}">
                                                    <i class="bi bi-key"></i> Reset Password
                                                </button>
                                            </td>
                                        </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                        ` : `
                        <div class="text-center py-5">
                            <i class="bi bi-people display-1 text-muted"></i>
                            <h4 class="mt-3">No students yet</h4>
                            <p class="text-muted">No students are currently enrolled in your class.</p>
                        </div>
                        `}
                    </div>
                </div>
            `;
            
            // Add event listeners for reset password buttons
            document.querySelectorAll('.reset-password').forEach(button => {
                button.addEventListener('click', function() {
                    const studentId = parseInt(this.dataset.id);
                    resetStudentPassword(studentId);
                });
            });
            
            // Add advanced filter functionality
            setupClassStudentFilters();
        }

        // Setup class student filters
        function setupClassStudentFilters() {
            // Toggle advanced filter panel
            document.getElementById('advancedFilterToggle').addEventListener('click', function() {
                const panel = document.getElementById('advancedFilterPanel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            });
            
            // Close advanced filter panel
            document.getElementById('closeAdvancedFilter').addEventListener('click', function() {
                document.getElementById('advancedFilterPanel').style.display = 'none';
            });
            
            // Apply filters
            document.getElementById('applyFilters').addEventListener('click', function() {
                applyClassStudentFilters();
            });
            
            // Reset filters
            document.getElementById('resetFilters').addEventListener('click', function() {
                resetClassStudentFilters();
            });
            
            // Search input
            document.getElementById('classStudentSearch').addEventListener('input', function() {
                applyClassStudentFilters();
            });
        }

        // Apply class student filters
        function applyClassStudentFilters() {
            const searchTerm = document.getElementById('classStudentSearch').value.toLowerCase();
            const admissionNoFilter = document.getElementById('admissionNoFilter').value.toLowerCase();
            const minRequests = parseInt(document.getElementById('minRequestsFilter').value) || 0;
            const maxRequests = parseInt(document.getElementById('maxRequestsFilter').value) || Infinity;
            
            // Get teacher's class
            const teacherClass = appState.currentUser.class;
            
            const filteredStudents = appState.data.students.filter(student => {
                const isInClass = student.class === teacherClass;
                const studentRequests = appState.data.requests.filter(req => req.studentId === student.id);
                const requestCount = studentRequests.length;
                
                const matchesSearch = student.name.toLowerCase().includes(searchTerm) || 
                                     student.username.toLowerCase().includes(searchTerm);
                const matchesAdmissionNo = !admissionNoFilter || student.admissionNo.toLowerCase().includes(admissionNoFilter);
                const matchesMinRequests = requestCount >= minRequests;
                const matchesMaxRequests = requestCount <= maxRequests;
                
                return isInClass && matchesSearch && matchesAdmissionNo && matchesMinRequests && matchesMaxRequests;
            });
            
            const tableBody = document.getElementById('classStudentTableBody');
            tableBody.innerHTML = filteredStudents.map(student => {
                const studentRequests = appState.data.requests.filter(req => req.studentId === student.id);
                const studentAmount = studentRequests
                    .filter(req => req.status === 'completed')
                    .reduce((sum, req) => sum + (req.price * req.quantity), 0);
                
                return `
                <tr>
                    <td>${student.admissionNo}</td>
                    <td>${student.name}</td>
                    <td>${student.username}</td>
                    <td>${studentRequests.length}</td>
                    <td>₹${studentAmount}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-secondary reset-password" data-id="${student.id}">
                            <i class="bi bi-key"></i> Reset Password
                        </button>
                    </td>
                </tr>
                `;
            }).join('');
            
            // Reattach event listeners
            document.querySelectorAll('.reset-password').forEach(button => {
                button.addEventListener('click', function() {
                    const studentId = parseInt(this.dataset.id);
                    resetStudentPassword(studentId);
                });
            });
        }

        // Reset class student filters
        function resetClassStudentFilters() {
            document.getElementById('classStudentSearch').value = '';
            document.getElementById('admissionNoFilter').value = '';
            document.getElementById('minRequestsFilter').value = '';
            document.getElementById('maxRequestsFilter').value = '';
            
            applyClassStudentFilters();
        }

        // Get status badge class
        function getStatusBadgeClass(status) {
            switch(status) {
                case 'pending': return 'badge-warning';
                case 'approved': return 'badge-primary';
                case 'completed': return 'badge-success';
                case 'rejected': return 'badge-danger';
                default: return 'badge-secondary';
            }
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            // Set message and type
            toastMessage.textContent = message;
            
            // Set icon based on type
            const toastHeader = toast.querySelector('.toast-header');
            const icon = toastHeader.querySelector('i');
            
            switch(type) {
                case 'success':
                    icon.className = 'bi bi-check-circle me-2 text-success';
                    break;
                case 'warning':
                    icon.className = 'bi bi-exclamation-triangle me-2 text-warning';
                    break;
                case 'error':
                    icon.className = 'bi bi-x-circle me-2 text-danger';
                    break;
                default:
                    icon.className = 'bi bi-info-circle me-2 text-primary';
            }
            
            // Show toast
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }

        // Logout user
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Reset app state
                appState.currentUser = null;
                appState.currentRole = 'student';
                appState.currentPage = 'dashboard';
                
                // Reset login form
                document.getElementById('loginForm').reset();
                document.querySelectorAll('.role-option').forEach(option => {
                    option.classList.remove('active');
                });
                document.querySelector('.role-option[data-role="student"]').classList.add('active');
                document.getElementById('roleSelect').value = 'student';
                
                // Show login page, hide app
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('appContainer').style.display = 'none';
                
                showToast('You have been logged out successfully.', 'info');
            }
        }

        // Load sample data for demonstration
        function loadSampleData() {
            // Sample classes
            appState.data.classes = [
                { id: 1, name: 'U1', teacher: 'Mr. Rahman', teacherUsername: 'rahman', teacherPassword: 'password', teacherEmail: 'rahman@niics.edu' },
                { id: 2, name: 'U2', teacher: 'Ms. Zara', teacherUsername: 'zara', teacherPassword: 'password', teacherEmail: 'zara@niics.edu' },
                { id: 3, name: 'U3', teacher: 'Mr. Ahmed', teacherUsername: 'ahmed', teacherPassword: 'password', teacherEmail: 'ahmed@niics.edu' }
            ];
            
            // Sample students
            appState.data.students = [
                { id: 1, admissionNo: 'S001', name: 'Ahmed Khan', class: 'U1', username: 'ahmed', password: 'password', email: 'ahmed@student.niics.edu' },
                { id: 2, admissionNo: 'S002', name: 'Fatima Ali', class: 'U1', username: 'fatima', password: 'password', email: 'fatima@student.niics.edu' },
                { id: 3, admissionNo: 'S003', name: 'Omar Hassan', class: 'U2', username: 'omar', password: 'password', email: 'omar@student.niics.edu' },
                { id: 4, admissionNo: 'S004', name: 'Aisha Mohammed', class: 'U2', username: 'aisha', password: 'password', email: 'aisha@student.niics.edu' },
                { id: 5, admissionNo: 'S005', name: 'Yusuf Ibrahim', class: 'U3', username: 'yusuf', password: 'password', email: 'yusuf@student.niics.edu' }
            ];
            
            // Sample stationery items
            appState.data.stationery = [
                { id: 1, name: 'Blue Pen', category: 'Writing', price: 10, stock: 50, description: 'Blue ink ballpoint pen' },
                { id: 2, name: 'Notebook', category: 'Notebook', price: 25, stock: 30, description: '100 pages ruled notebook' },
                { id: 3, name: 'Pencil', category: 'Writing', price: 5, stock: 100, description: 'HB graphite pencil' },
                { id: 4, name: 'Eraser', category: 'Writing', price: 3, stock: 80, description: 'Soft rubber eraser' },
                { id: 5, name: 'Sharpener', category: 'Writing', price: 8, stock: 40, description: 'Metal blade sharpener' },
                { id: 6, name: 'Ruler', category: 'Drawing', price: 15, stock: 25, description: '30cm plastic ruler' },
                { id: 7, name: 'File Folder', category: 'Files', price: 20, stock: 15, description: 'A4 size file folder' },
                { id: 8, name: 'Stapler', category: 'Other', price: 50, stock: 5, description: 'Mini stapler with pins' }
            ];
            
            // Sample requests
            appState.data.requests = [
                { id: 1, studentId: 1, itemId: 1, itemName: 'Blue Pen', quantity: 2, date: '2023-11-10', status: 'completed', price: 10 },
                { id: 2, studentId: 1, itemId: 2, itemName: 'Notebook', quantity: 1, date: '2023-11-12', status: 'approved', price: 25 },
                { id: 3, studentId: 2, itemId: 3, itemName: 'Pencil', quantity: 3, date: '2023-11-13', status: 'pending', price: null },
                { id: 4, studentId: 3, itemId: 4, itemName: 'Eraser', quantity: 1, date: '2023-11-14', status: 'completed', price: 3 },
                { id: 5, studentId: 4, itemId: 5, itemName: 'Sharpener', quantity: 1, date: '2023-11-15', status: 'rejected', price: null },
                { id: 6, studentId: 5, itemId: 6, itemName: 'Ruler', quantity: 1, date: '2023-11-15', status: 'pending', price: null }
            ];
        }
    </script>
</body>
</html>